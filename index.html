<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.4.551" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Ryan Crawford" />
<meta name="author" content="Jamie Crawford" />
<meta name="author" content="Lawrence B. Smart" />
<meta name="author" content="Virginia Moore" />
<meta name="dcterms.date" content="2024-04-01" />
<meta name="keywords" content="Hemp, Grain, Spectroscopy" />

<title>Near Infra-Red Spectroscopy Predicts Crude Protein in Hemp Grain</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<!-- htmldependencies:E3FAD763 -->
<script async src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <div id="quarto-toc-target"></div>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default toc-left">
  <div class="quarto-title-banner">
    <div class="quarto-title column-body">
      <h1 class="title">Near Infra-Red Spectroscopy Predicts Crude Protein in Hemp Grain</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Authors</div>
          <div class="quarto-title-meta-heading">Affiliations</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Ryan Crawford <a href="mailto:rvc3@cornell.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Cornell University
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Jamie Crawford </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Cornell University
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Lawrence B. Smart </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Cornell AgriTech
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Virginia Moore </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Cornell University
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">April 1, 2024</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      </div>
    </div>

    <div>
      <div class="keywords">
        <div class="block-title">Keywords</div>
        <p>Hemp, Grain, Spectroscopy</p>
      </div>
    </div>

    <div class="quarto-other-links-text-target">
    </div>  </div>
</header>

  

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction"><span class="header-section-number">1</span> INTRODUCTION</a></li>
  <li><a href="#materials-and-methods" id="toc-materials-and-methods"><span class="header-section-number">2</span> MATERIALS AND METHODS</a>
  <ul>
  <li><a href="#hemp-grain-sample-background" id="toc-hemp-grain-sample-background"><span class="header-section-number">2.1</span> Hemp Grain Sample Background</a></li>
  <li><a href="#spectral-data-collection-and-preprocessing" id="toc-spectral-data-collection-and-preprocessing"><span class="header-section-number">2.2</span> Spectral Data Collection and Preprocessing</a></li>
  <li><a href="#laboratory-validation" id="toc-laboratory-validation"><span class="header-section-number">2.3</span> Laboratory Validation</a></li>
  <li><a href="#model-development" id="toc-model-development"><span class="header-section-number">2.4</span> Model Development</a></li>
  <li><a href="#additional-software-used" id="toc-additional-software-used"><span class="header-section-number">2.5</span> Additional software used</a></li>
  </ul></li>
  <li><a href="#results-and-discussion" id="toc-results-and-discussion"><span class="header-section-number">3</span> RESULTS AND DISCUSSION</a>
  <ul>
  <li><a href="#laboratory-assay-cp-values" id="toc-laboratory-assay-cp-values"><span class="header-section-number">3.1</span> Laboratory assay CP values</a></li>
  <li><a href="#preprocessing-methods-comparison" id="toc-preprocessing-methods-comparison"><span class="header-section-number">3.2</span> Preprocessing methods comparison</a></li>
  <li><a href="#final-model-development-and-summary" id="toc-final-model-development-and-summary"><span class="header-section-number">3.3</span> Final model development and summary</a></li>
  </ul></li>
  <li><a href="#acknowledgments" id="toc-acknowledgments"><span class="header-section-number">4</span> ACKNOWLEDGMENTS</a></li>
  <li><a href="#supplemental-material" id="toc-supplemental-material"><span class="header-section-number">5</span> SUPPLEMENTAL MATERIAL</a></li>
  <li><a href="#optional-sections" id="toc-optional-sections"><span class="header-section-number">6</span> OPTIONAL SECTIONS</a></li>
  <li><a href="#references" id="toc-references"><span class="header-section-number">7</span> REFERENCES</a></li>
  <li><a href="#figures-and-tables" id="toc-figures-and-tables"><span class="header-section-number">8</span> FIGURES AND TABLES</a></li>
  <li><a href="#sec-data-methods" id="toc-sec-data-methods"><span class="header-section-number">9</span> Data &amp; Methods</a></li>
  <li><a href="#conclusion" id="toc-conclusion"><span class="header-section-number">10</span> Conclusion</a></li>
  <li><a href="#references-1" id="toc-references-1">References</a></li>
  </ul>
</nav>
<p><strong>incomplete: may contain errors, run-ons, half-thoughts, etc.</strong></p>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1"><span class="header-section-number">1</span> INTRODUCTION</h2>
<p>Hemp (Cannabis sativa L.) is an annual crop with potential uses as a source of food or feed from grain, and bast fiber or hurd from the stalk. Hemp cultivars are commonly grown for one or both purposes and a cultivar may be referred to as a grain, fiber, or dual-purpose type. Because of protein’s nutritional importance, the protein content of a grain crop is an prime consideration for researchers, producers, and consumers. Whole hemp grain typically contains approximately 20-30% protein <span class="citation" data-cites="ely_industrial_2022 barta_proteomic_2024 callaway_hempseed_2004">(<a href="#ref-barta_proteomic_2024" role="doc-biblioref">Bárta et al., 2024</a>; <a href="#ref-callaway_hempseed_2004" role="doc-biblioref">Callaway, 2004</a>; <a href="#ref-ely_industrial_2022" role="doc-biblioref">Ely &amp; Fike, 2022</a>)</span>. Crude protein (CP) is often used as a proxy for the direct measurement of protein concentration and consists of the multiplication of nitrogen concentration by a conversion factor because measuring nitrogen concentration is relatively simple <span class="citation" data-cites="hayes_measuring_2020">(<a href="#ref-hayes_measuring_2020" role="doc-biblioref">Hayes, 2020</a>)</span>.</p>
<p>Near-infrared spectroscopy (NIRS) technology is rapid, non-destructive, and cheap. It consists of the measurement of NIR radiation reflected and absorbed from a sample (the spectra) and the relation of the spectra to laboratory values for components such as moisture, protein, fat, or fiber <span class="citation" data-cites="roberts_near-infrared_2004">(<a href="#ref-roberts_near-infrared_2004" role="doc-biblioref">Roberts et al., 2004</a>)</span>. NIRS technology has been used since the 1970’s to assess forage CP <span class="citation" data-cites="reeves_potential_2012 williams_application_1975">(<a href="#ref-reeves_potential_2012" role="doc-biblioref">Reeves, 2012</a>; <a href="#ref-williams_application_1975" role="doc-biblioref">Williams, 1975</a>)</span>. A NIRS calibration set often consists of samples from one species grown in many environments encompassing the range of expected values from the analyte or analytes <span class="citation" data-cites="chadalavada_nir_2022">(<a href="#ref-chadalavada_nir_2022" role="doc-biblioref">Chadalavada et al., 2022</a>)</span>. Partial least squares regression (PLSR) is a typical method used in the agricultural and food sciences to relate spectra to analyte <span class="citation" data-cites="roberts_near-infrared_2004">(<a href="#ref-roberts_near-infrared_2004" role="doc-biblioref">Roberts et al., 2004</a>)</span>. PLSR calculates components that maximize covariance between predictor and response variables. PLSR uses some number of components, often selected via cross-validation, in order to fit the regression model and is commonly used in spectroscopy because it tends to work well with highly-correlated, noisy spectral data <span class="citation" data-cites="wold_pls-regression_2001">(<a href="#ref-wold_pls-regression_2001" role="doc-biblioref">Wold et al., 2001</a>)</span>.</p>
<p>A NIRS-scanned sample of undamaged grain may used for other purposes besides its scan or it may planted as a seed. In wheat and corn, grain protein content has been shown to be heritable <span class="citation" data-cites="giancaspro_genetic_2019 geyer_genetics_2022">(<a href="#ref-geyer_genetics_2022" role="doc-biblioref">Geyer et al., 2022</a>; <a href="#ref-giancaspro_genetic_2019" role="doc-biblioref">Giancaspro et al., 2019</a>)</span>. This suggests (at least potentially) that NIRS technology could serve as resource to rapidly identify high CP hemp germplasm, enabling the screening of more germplam as grain, before planting to the field, and thus enabling the more efficient development of high CP hemp grain cultivars.</p>
<p>For this study, a benchtop NIR spectrometer was used to develop a model to predict CP content based on a data set of hemp grain representing multiple years, locations, and cultivars from grain and dual-purpose hemp types using PLSR.</p>
</section>
<section id="materials-and-methods" class="level2" data-number="2">
<h2 data-number="2"><span class="header-section-number">2</span> MATERIALS AND METHODS</h2>
<section id="hemp-grain-sample-background" class="level3" data-number="2.1">
<h3 data-number="2.1"><span class="header-section-number">2.1</span> Hemp Grain Sample Background</h3>
<p>Spectral data were obtained from whole (unground) hemp grain samples, harvested at maturity, collected from 2017 - 2021 from 18 cultivar trials in New York (NY) (NA samples). Grain samples were obtained by hand sampling or mechanical harvest and were cleaned of chaff and dried at 30 C for six days in a forced-air dryer. In total, 38 cultivars were represented in the data set. Cultivars were grain or dual-purpose types and included both commercially available and experimental material.</p>
<p>All cultivar trials were planted in randomized complete block design with each cultivar replicated four times. The 2017 data were comprised of samples from the same thirteen cultivars sampled from six NY locations. For those trials, grain was harvested from each plot individually and aggregated by cultivar within each trial. Four subsamples were drawn from each aggregated sample and scanned separately. These spectra were averaged at each 2 nm increment. All remaining samples from 2018-2021 were collected on a per-plot basis. All possible cultivars and possible locations were represented in 2017, but only a selected subset of cultivars and locations were represented in 2018-2021.</p>
</section>
<section id="spectral-data-collection-and-preprocessing" class="level3" data-number="2.2">
<h3 data-number="2.2"><span class="header-section-number">2.2</span> Spectral Data Collection and Preprocessing</h3>
<p>A benchtop NIR spectrometer (FOSS/ NIR FOSS/ NIR Systems model 5000) was used to obtain the spectra (FOSS North America, Eden Prairie, MN, USA). Spectra were collected every 2 nm from 1100-2498 nm and the logarithm of reciprocal reflectance was recorded. A 1/4 rectangular sample cup (5.7 cm× 4.6 cm) was used.</p>
<p>WINISI software version 1.02A (Infrasoft International, Port Matilda, PA, USA) was used to average the spectra in 2017, as well as to select samples for laboratory assay. Samples were selected according to their spectral distance from their nearest neighbor within the calibration data set with a cutoff of a distance of 0.6 H, where H is approximately equal to the squared Mahalanobis distance divided by the number of principal components used in the calculation <span class="citation" data-cites="garrido-varo_note_2019">(<a href="#ref-garrido-varo_note_2019" role="doc-biblioref">Garrido-Varo et al., 2019</a>)</span>. Prior to selection selection, spectra were preprocessed using SNV-detrend with settings 1,4,4,1 for the derivative, gap, smooth, and smooth 2 settings respectively.</p>
</section>
<section id="laboratory-validation" class="level3" data-number="2.3">
<h3 data-number="2.3"><span class="header-section-number">2.3</span> Laboratory Validation</h3>
<p>Laboratory assays were performed by Dairy One Forage Laboratory (Ithaca, NY). For those assays, 1mm ground samples were analyzed by combustion using a CN628 or CN928 Carbon/Nitrogen Determinator. Samples from 2017 were aggregated as described above, but the remaining samples were not aggregated.</p>
</section>
<section id="model-development" class="level3" data-number="2.4">
<h3 data-number="2.4"><span class="header-section-number">2.4</span> Model Development</h3>
<p>Calibration and validations sets were created by dividing the laboratory CP values into tertiles according to their percent CP in order to ensure that the range of CP values was present in both calibration and testing sets. Within each tertile, 75% of the samples were randomly assigned to the calibration set and the remaining 25% were assigned to the testing set. For each calibration set, models were developed in the caret package using PLSR. In fitting the model, the number of components was optimized over a grid search from 1-20. Model performance was evaluated with 25 iterations of bootstrapping and minimized root mean squared error (RMSE) in selecting the number of components in the final model .</p>
<p>Initially a number of common spectral preprocessing methods were tested by creating 100 calibration and testing sets, as described above. Spectral data from those data sets were transformed by each of the following methods: 1) first derivative, 2) Savitzky-Golay (SG) using the first derivative, third order polynomial, and a window of size 5, 3) gap-segment derivative using the first derivative, a gap of eleven, and a segment size of 5, 4) standard normal variate (SNV), 5) standard normal variate following Savitzky-Golay (SNV-SG) (same SG parameters as above), 6) SNV-detrend with second order polynomial, and 7) multiplicative scatter correction. As a comparison, models were also developed using untransformed spectra.</p>
<p>For each of these preprocessing methods, models were fit and predictions were made on the corresponding validation set (since there were 8 preprocessing methods, 8 separate models were fit for each of the 100 sets. The relationship between the predicted and actual values of the testing set were calculated via RMSE, R<sup>2</sup> and Ratio of Performance to InterQuartile distance (RPIQ), three common model assessment metrics. Larger R<sup>2</sup> and RPIQ, and smaller RMSE values are superior. Analyses of variance (ANOVA) were performed for each of these metrics in order to compare the preprocessing methods. For each ANOVA, each data set was considered as a subject and different variances were allowed for each preprocessing method.</p>
<p>Once the most promising preprocessing method was identified, 1000 more data sets were created and analyzed via that method and performance on the testing sets was summarized with RMSE, R<sup>2</sup>, and RPIQ.</p>
</section>
<section id="additional-software-used" class="level3" data-number="2.5">
<h3 data-number="2.5"><span class="header-section-number">2.5</span> Additional software used</h3>
<!-- Additional analyses were performed using R Statistical Software [@r_core_team_r_2024]. Data were tabulated and summarized using the tidyverse and data.table \[@barrett_datatable_2024; @wickham_welcome_2019\]. PLSR models were constructed using the pls package and validated using caret \[@kuhn_building_2008; @liland_pls_2023\]. -->
<div class="cell">
<div class="cell-output-display">
<p>We used R version 4.3.3 <span class="citation" data-cites="base">(<a href="#ref-base" role="doc-biblioref">R Core Team, 2024</a>)</span> and the following R packages: caret v. 6.0.94 <span class="citation" data-cites="caret">(<a href="#ref-caret" role="doc-biblioref">Kuhn &amp; Max, 2008</a>)</span>, data.table v. 1.15.2 <span class="citation" data-cites="datatable">(<a href="#ref-datatable" role="doc-biblioref">Barrett et al., 2024</a>)</span>, emmeans v. 1.10.0 <span class="citation" data-cites="emmeans">(<a href="#ref-emmeans" role="doc-biblioref">Lenth, 2024</a>)</span>, nlme v. 3.1.163 <span class="citation" data-cites="nlme2000 nlme2023">(<a href="#ref-nlme2023" role="doc-biblioref">J. Pinheiro et al., 2023</a>; <a href="#ref-nlme2000" role="doc-biblioref">J. C. Pinheiro &amp; Bates, 2000</a>)</span>, pls v. 2.8.3 <span class="citation" data-cites="pls">(<a href="#ref-pls" role="doc-biblioref">Liland et al., 2023</a>)</span>, prospectr v. 0.2.7 <span class="citation" data-cites="prospectr">(<a href="#ref-prospectr" role="doc-biblioref">Stevens &amp; Ramirez-Lopez, 2024</a>)</span>, skimr v. 2.1.5 <span class="citation" data-cites="skimr">(<a href="#ref-skimr" role="doc-biblioref">Waring et al., 2022</a>)</span>, tidymodels v. 1.1.1 <span class="citation" data-cites="tidymodels">(<a href="#ref-tidymodels" role="doc-biblioref">Kuhn &amp; Wickham, 2020</a>)</span>, tidyverse v. 2.0.0 <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham et al., 2019</a>)</span>.</p>
</div>
</div>
</section>
</section>
<section id="results-and-discussion" class="level2" data-number="3">
<h2 data-number="3"><span class="header-section-number">3</span> RESULTS AND DISCUSSION</h2>
<section id="laboratory-assay-cp-values" class="level3" data-number="3.1">
<h3 data-number="3.1"><span class="header-section-number">3.1</span> Laboratory assay CP values</h3>
<p>Laboratory assay percent CP values are summarized in the following table. These are similar to the range of CP values observed in the literature, indicating an reasonable basis for a chemometric model. The CP values are left-skewed and two thirds of the samples contained more than 25% CP.</p>
<div class="cell">
<div id="tbl-lab-protein-vals" class="cell quarto-float">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lab-protein-vals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 1: Summary of Laboratory Assayed CP Values (Percent Dry Matter)
</figcaption>
<div aria-describedby="tbl-lab-protein-vals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell">
<thead>
<tr class="header">
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">Sd</th>
<th style="text-align: right;">Minimum</th>
<th style="text-align: right;">First Quartile</th>
<th style="text-align: right;">Median</th>
<th style="text-align: right;">Third Quartile</th>
<th style="text-align: right;">Maximum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">26.1</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">20.8</td>
<td style="text-align: right;">23.9</td>
<td style="text-align: right;">26.4</td>
<td style="text-align: right;">28.2</td>
<td style="text-align: right;">30.8</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="preprocessing-methods-comparison" class="level3" data-number="3.2">
<h3 data-number="3.2"><span class="header-section-number">3.2</span> Preprocessing methods comparison</h3>
<p>All preprocessing methods outperformed untransformed spectral data <a href="#tbl-preproc" class="quarto-xref">Table 2</a>. Averaged together, all preprocessed spectra were superior to untransformed spectra, with lower RMSE, and higher R<sup>2</sup> and RPIQ values (significant at <span class="math inline">\(\alpha\)</span> level &lt;0.001). Preprocessing methods had -11.6 % lower RMSE, and had 3.1% higher R<sup>2</sup> 7.4% higher RPIQ than unprocessed spectra.</p>
<p>The SNV-SG method had the lowest RMSE, highest R<sup>2</sup>, and highest RPIQ averaging over all iterations. SNV-SG RMSE averaged 1.4% lower, while R<sup>2</sup> and RPIQ averaged 0.4% and 2.4% higher respectively than the next best preprocessing method (SG in both cases), but the difference between the best and second best method by metric were only statistically significant at <span class="math inline">\(\alpha\)</span> &lt;0.05 for RPIQ. RPIQ was devised to accurately reflect the spread of data in skewed populations <span class="citation" data-cites="bellon-maurel_critical_2010">(<a href="#ref-bellon-maurel_critical_2010" role="doc-biblioref">Bellon-Maurel et al., 2010</a>)</span> and thus offers a robust metric for model assessment in this context, where the CP data are skewed. Therefore the superiority of SNV-SG as measured via RPIQ made it the best choice for the final model.</p>
<div class="cell">
<div id="tbl-preproc" class="cell quarto-float">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-preproc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 2: Evaluation of Preprocessing Methods by Metric ± Standard Error
</figcaption>
<div aria-describedby="tbl-preproc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell" style="width:100%;">
<colgroup>
<col style="width: 55%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Preprocessing Method</th>
<th style="text-align: left;">RMSE</th>
<th style="text-align: left;"><span class="math inline">\(R^{2}\)</span></th>
<th style="text-align: left;">RPIQ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Standard Normal Variate following Savitzky-Golay</td>
<td style="text-align: left;">1.02 ± 0.012</td>
<td style="text-align: left;">0.84 ± 0.004</td>
<td style="text-align: left;">3.97 ± 0.076</td>
</tr>
<tr class="even">
<td style="text-align: left;">Savitzky-Golay</td>
<td style="text-align: left;">1.03 ± 0.012</td>
<td style="text-align: left;">0.83 ± 0.004</td>
<td style="text-align: left;">3.88 ± 0.072</td>
</tr>
<tr class="odd">
<td style="text-align: left;">First Derivative</td>
<td style="text-align: left;">1.07 ± 0.013</td>
<td style="text-align: left;">0.82 ± 0.004</td>
<td style="text-align: left;">3.77 ± 0.075</td>
</tr>
<tr class="even">
<td style="text-align: left;">Standard Normal Variate</td>
<td style="text-align: left;">1.12 ± 0.016</td>
<td style="text-align: left;">0.80 ± 0.005</td>
<td style="text-align: left;">3.61 ± 0.081</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gap-segment Derivative</td>
<td style="text-align: left;">1.12 ± 0.018</td>
<td style="text-align: left;">0.81 ± 0.006</td>
<td style="text-align: left;">3.60 ± 0.086</td>
</tr>
<tr class="even">
<td style="text-align: left;">Standard Normal Variate-Detrend</td>
<td style="text-align: left;">1.13 ± 0.015</td>
<td style="text-align: left;">0.80 ± 0.005</td>
<td style="text-align: left;">3.55 ± 0.079</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiplicative Scatter Correction</td>
<td style="text-align: left;">1.17 ± 0.016</td>
<td style="text-align: left;">0.79 ± 0.006</td>
<td style="text-align: left;">3.47 ± 0.080</td>
</tr>
<tr class="even">
<td style="text-align: left;">Untransformed Spectra</td>
<td style="text-align: left;">1.22 ± 0.044</td>
<td style="text-align: left;">0.79 ± 0.009</td>
<td style="text-align: left;">3.42 ± 0.105</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>These results are not surprising. SNV and SNV-detrend both correct light scatter, which is often a function of differences in particle size and sample packing density, although SNV-detrend is often used for densely-packed, powdered samples <span class="citation" data-cites="barnes_standard_1989">(<a href="#ref-barnes_standard_1989" role="doc-biblioref">Barnes et al., 1989</a>)</span>. Here, hemp grain was neither powdered nor densely packed SG is a smoothing filter that regresses on the signal over a series of windows, removing noise while preserving the signal’s shape and features.<span class="citation" data-cites="li_quantitative_2020 luo_properties_2005">(<a href="#ref-li_quantitative_2020" role="doc-biblioref">Li et al., 2020</a>; <a href="#ref-luo_properties_2005" role="doc-biblioref">Luo et al., 2005</a>)</span>. Derivatives remove noise, but not necessarily light scatte</p>
<p><strong>cite:</strong> Barnes RJ, Dhanoa MS, Lister SJ. 1989. Standard normal variate transformation and de-trending of near-infrared diffuse reflectance spectra. Applied spectroscopy, 43(5): 772-777.</p>
<p>The preprocessing methods examined represent a portion of those available. As well, preprocessing methods tend to have a number of user-adjustable parameters whose various permutations were not tested. This subset of preprocessing methods and parameters nonetheless contained substantial variations in model quality, demonstrating the importance of the selection of an appropriate preprocessing method.</p>
</section>
<section id="final-model-development-and-summary" class="level3" data-number="3.3">
<h3 data-number="3.3"><span class="header-section-number">3.3</span> Final model development and summary</h3>
<p>The model improved most rapidly as the number of principal components increased from 1 to 7, with the inclusion of each additional PC being associated with a decrease in RMSE of 5-12% . From 8 to 12 PCs, model performance continued to improve, although gains were more modest (decrease in RMSE of 0.7-3%). With 13 or more PCs, performance gains were minimal and the relative ranks of the models tended to be stable <a href="#fig-model-calibration" class="quarto-xref">Figure 1</a>.</p>
<div id="cell-fig-model-calibration" class="cell">
<div class="cell-output-display">
<div id="fig-model-calibration" class="quarto-figure quarto-figure-center quarto-float">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-calibration-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-model-calibration-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1"><img src="index_files/figure-html/fig-model-calibration-1.png" class="img-fluid" width="672" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-calibration-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1: Decreasing RMSE with increasing number of PCs
</figcaption>
</figure>
</div>
</div>
</div>
<p>Final model performance was similar, but not identical to, that obtained during the initial comparison of preprocessing methods. The final models’ mean RMSE was 1.03, R<sup>2</sup> was 0.83, and RPIQ was 3.89 (all calculated on the test sets). Despite the generally good model performance, a subset of poor models can be seen. For example, <a href="#fig-final-metric-boxplot" class="quarto-xref">Figure 2</a> shows twenty-one models with R<sup>2</sup> below 0.7. <strong>more comment on poor models?</strong></p>
<div id="cell-fig-final-metric-boxplot" class="cell">
<div class="cell-output-display">
<div id="fig-final-metric-boxplot" class="quarto-figure quarto-figure-center quarto-float">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-final-metric-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-final-metric-boxplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2"><img src="index_files/figure-html/fig-final-metric-boxplot-1.png" class="img-fluid" width="672" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-final-metric-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 2: Final model validation set performance (1000 iterations)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = difference ~ adj_cp, data = temp_dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.51794 -0.58132  0.06936  0.50754  2.74745 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.80412    0.17827   4.511 1.31e-05 ***
adj_cp      -0.15334    0.03051  -5.026 1.44e-06 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.9138 on 147 degrees of freedom
Multiple R-squared:  0.1466,    Adjusted R-squared:  0.1408 
F-statistic: 25.26 on 1 and 147 DF,  p-value: 1.438e-06</code></pre>
</div>
</div>
<p>Finally, the pattern of errors was examined on a per-sample basis. <a href="#fig-validation_set_performance" class="quarto-xref">Figure 3</a></p>
<div id="cell-fig-validation_set_performance" class="cell">
<div class="cell-output-display">
<div id="fig-validation_set_performance" class="quarto-figure quarto-figure-center quarto-float">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-validation_set_performance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-validation_set_performance-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3"><img src="index_files/figure-html/fig-validation_set_performance-1.png" class="img-fluid" width="672" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-validation_set_performance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3: Test set prediction errors on a per-sample basis. Actual sample value set to 0, and samples ranked from least to greatest actual % CP value
</figcaption>
</figure>
</div>
</div>
</div>
<p><br />
</p>
<p>To assess the patterns of errors within the models, a linear model was fit considering the mean estimated error for each sample considering all models where that sample was in the test set when compared to the sample’s actual value. The models overestimated %CP by approximately 0.5 % in the lowest tertile and underestimated %CP by -0.01 % and -0.41 % in the middle and highest tertile, respectively</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;loc&gt;
          loc ith_in_data_set crude_protein   difference tmp_ith adj_cp
       &lt;char&gt;           &lt;int&gt;         &lt;num&gt;        &lt;num&gt;   &lt;int&gt;  &lt;num&gt;
 1:     cnoll               4          27.1 -1.826000348      90    6.3
 2:      free              91          23.1 -1.608410140      24    2.3
 3:      free             100          27.5  0.008386084     100    6.7
 4:      free             103          26.0 -0.095290561      64    5.2
 5:     freev              66          28.3  0.156805468     117    7.5
 6:     freev              69          28.7  0.115415937     128    7.9
 7:     freev              70          27.3  0.123941888      93    6.5
 8:    ithaca             123          25.9  0.137420230      60    5.1
 9:    ithaca             124          23.2  2.325322409      27    2.4
10:    ithaca             125          23.2  2.582685059      25    2.4
11:    ithaca             140          23.5  1.597167816      30    2.7
12:    ithaca             146          28.0 -1.965391942     110    7.2
13:    ithaca             148          26.4  0.145123025      76    5.6
14:       mcg              92          22.7 -0.110406545      20    1.9
15:       mcg              94          28.1 -0.067559276     111    7.3
16:       mcg             121          28.3 -2.434565554     115    7.5
17:      mg4e              28          25.4  0.034158139      53    4.6
18:      mg4e              39          26.1 -0.016921027      66    5.3
19:      mg4l              41          26.4  0.118021909      74    5.6
20: rn041_gen             108          27.0  2.600884960      86    6.2
21: rn041_gen             109          23.7 -1.980462540      33    2.9
22: rn041_gen             110          29.0 -2.495337360     135    8.2
23: rn041_gen             111          29.6 -1.777305991     140    8.8
24: rn041_gen             113          29.5  0.011781362     139    8.7
25: rn041_gen             114          27.7  2.115039075     107    6.9
26:     rnooa              14          29.1 -0.003578789     137    8.3
27:     rnooa              18          23.1  2.020690041      22    2.3
28:     rnooa              19          25.3 -0.110141285      52    4.5
29:     rnooa              25          26.6 -2.603177621      78    5.8
30:     rnooa              26          28.3 -2.034162792     114    7.5
          loc ith_in_data_set crude_protein   difference tmp_ith adj_cp
                  grouping temp_id harv_year         cultivar         type
                    &lt;char&gt;   &lt;int&gt;     &lt;int&gt;           &lt;char&gt;       &lt;char&gt;
 1: worst_predicted_10_pct      32      2017            cfx-1             
 2: worst_predicted_10_pct     111      2018           grandi        grain
 3:   best_predicted_10pct     128      2019            canda        grain
 4:   best_predicted_10pct     131      2019        nwg-elite         dual
 5:   best_predicted_10pct      94      2017           picolo             
 6:   best_predicted_10pct      97      2017        futura 75             
 7:   best_predicted_10pct      98      2017            cfx-1             
 8:   best_predicted_10pct     155      2020         nwg-2730   multistate
 9: worst_predicted_10_pct     152      2020        futura 75 dual_replant
10: worst_predicted_10_pct     156      2020    bialobrzeskie   multistate
11: worst_predicted_10_pct       9      2021         logan c2         exp.
12: worst_predicted_10_pct       5      2021            crs-1   grain_dual
13:   best_predicted_10pct      10      2021  logan x anka c2         exp.
14:   best_predicted_10pct     115      2018 nebraska (feral)         dual
15:   best_predicted_10pct     113      2018           picolo        grain
16: worst_predicted_10_pct     149      2019             h-51   multistate
17:   best_predicted_10pct      56      2017            cfx-2             
18:   best_predicted_10pct      67      2017        futura 75             
19:   best_predicted_10pct      69      2017             anka             
20: worst_predicted_10_pct     136      2019        earlina 8        grain
21: worst_predicted_10_pct     137      2019           katani        grain
22: worst_predicted_10_pct     138      2019             joey        grain
23: worst_predicted_10_pct     139      2019        futura 75         dual
24:   best_predicted_10pct     141      2019             h-51         dual
25: worst_predicted_10_pct     142      2019           hliana         dual
26:   best_predicted_10pct      42      2017            tygra             
27: worst_predicted_10_pct      46      2017           katani             
28:   best_predicted_10pct      47      2017            cfx-2             
29: worst_predicted_10_pct      53      2017            cfx-1             
30: worst_predicted_10_pct      54      2017            wojko             
                  grouping temp_id harv_year         cultivar         type
     in_ny      loc2
    &lt;lgcl&gt;    &lt;char&gt;
 1:   TRUE    geneva
 2:   TRUE freeville
 3:   TRUE freeville
 4:   TRUE freeville
 5:   TRUE freeville
 6:   TRUE freeville
 7:   TRUE freeville
 8:   TRUE    ithaca
 9:   TRUE    ithaca
10:   TRUE    ithaca
11:   TRUE    ithaca
12:   TRUE    ithaca
13:   TRUE    ithaca
14:   TRUE    ithaca
15:   TRUE    ithaca
16:   TRUE    ithaca
17:   TRUE    ithaca
18:   TRUE    ithaca
19:   TRUE    ithaca
20:   TRUE    geneva
21:   TRUE    geneva
22:   TRUE    geneva
23:   TRUE    geneva
24:   TRUE    geneva
25:   TRUE    geneva
26:   TRUE    geneva
27:   TRUE    geneva
28:   TRUE    geneva
29:   TRUE    geneva
30:   TRUE    geneva
     in_ny      loc2</code></pre>
</div>
</div>
<p>This study is limited in that it represents the creation of one model based upon spectra collected from one machine. NIRS calibrations can be unique to a particular machine, even if the machines compared are of the same model <span class="citation" data-cites="reeves_potential_2012">(<a href="#ref-reeves_potential_2012" role="doc-biblioref">Reeves, 2012</a>)</span>. As well, the calibration and validation sets are relatively small.</p>
<p>This research showed the promise of the use of NIRS in order to make predictions concerning %CP in hemp grain using PLS. Promising preprocessing methods were identified and a model was validated. Further research could refine a CP model by including more samples, identifying promising spectral regions, or by examining other predictive methods.</p>
</section>
</section>
<section id="acknowledgments" class="level2" data-number="4">
<h2 data-number="4"><span class="header-section-number">4</span> ACKNOWLEDGMENTS</h2>
</section>
<section id="supplemental-material" class="level2" data-number="5">
<h2 data-number="5"><span class="header-section-number">5</span> SUPPLEMENTAL MATERIAL</h2>
<div class="cell">
<div id="tbl-hemp_provenance" class="cell quarto-float">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-hemp_provenance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 3: Tally of hemp cultivars and locations. Private cultivars are labeled “cultivar1”, “cultivar2”, etc.
</figcaption>
<div aria-describedby="tbl-hemp_provenance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell">
<thead>
<tr class="header">
<th style="text-align: left;">cultivar2</th>
<th style="text-align: right;">chazy</th>
<th style="text-align: right;">freeville</th>
<th style="text-align: right;">geneva</th>
<th style="text-align: right;">ithaca</th>
<th style="text-align: right;">willsboro</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">altair</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">anka</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bialobrzeskie</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">canda</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cfx-1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">cfx-2</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">crs-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">cultivar1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cultivar2</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">cultivar3</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cultivar4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">earlina 8</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">experimental1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">experimental2</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">felina 32</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">futura 75</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grandi</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">h-51</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">han-fn-h</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">han-nw</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">helena</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">henola</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hlesia</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">3</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">hliana</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">joey</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">katani</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nebraska (feral)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">pewter river</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">picolo</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">portugal</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rocky hemp</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">sterling gold</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">swift</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">tygra</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">uso-31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">wojko</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x-59</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">149</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="optional-sections" class="level2" data-number="6">
<h2 data-number="6"><span class="header-section-number">6</span> OPTIONAL SECTIONS</h2>
</section>
<section id="references" class="level2" data-number="7">
<h2 data-number="7"><span class="header-section-number">7</span> REFERENCES</h2>
</section>
<section id="figures-and-tables" class="level2" data-number="8">
<h2 data-number="8"><span class="header-section-number">8</span> FIGURES AND TABLES</h2>
<div id="cell-fig-timeline" class="cell">
<div class="cell-output-display">
<div id="fig-timeline" class="quarto-figure quarto-figure-center quarto-float" alt="An event plot of the years of the last 8 eruptions on La Palma.">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-timeline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-timeline-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" data-glightbox="description: .lightbox-desc-4"><img src="index_files/figure-html/fig-timeline-1.png" class="img-fluid" alt="An event plot of the years of the last 8 eruptions on La Palma." width="576" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-timeline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 4: Timeline of recent earthquakes on La Palma
</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on data up to and including 1971, eruptions on La Palma happen every 79.8 years on average.</p>
<p>Studies of the magma systems feeding the volcano, such as <span class="citation" data-cites="marrero2019">(<a href="#ref-marrero2019" role="doc-biblioref"><strong>marrero2019?</strong></a>)</span>, have proposed that there are two main magma reservoirs feeding the Cumbre Vieja volcano; one in the mantle (30-40km depth) which charges and in turn feeds a shallower crustal reservoir (10-20km depth).</p>
<p>Eight eruptions have been recorded since the late 1400s (<a href="#fig-timeline" class="quarto-xref">Figure 4</a>).</p>
<p>Data and methods are discussed in <a href="#sec-data-methods" class="quarto-xref">Section 9</a>.</p>
<p>Let <span class="math inline">\(x\)</span> denote the number of eruptions in a year. Then, <span class="math inline">\(x\)</span> can be modeled by a Poisson distribution</p>
<p><span id="eq-poisson"><span class="math display">\[
p(x) = \frac{e^{-\lambda} \lambda^{x}}{x !}
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(\lambda\)</span> is the rate of eruptions per year. Using <a href="#eq-poisson" class="quarto-xref">Equation 1</a>, the probability of an eruption in the next <span class="math inline">\(t\)</span> years can be calculated.</p>
<div id="tbl-history" class="quarto-float">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-history-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 4: Recent historic eruptions on La Palma
</figcaption>
<div aria-describedby="tbl-history-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Current</td>
<td>2021</td>
</tr>
<tr class="even">
<td>Teneguía</td>
<td>1971</td>
</tr>
<tr class="odd">
<td>Nambroque</td>
<td>1949</td>
</tr>
<tr class="even">
<td>El Charco</td>
<td>1712</td>
</tr>
<tr class="odd">
<td>Volcán San Antonio</td>
<td>1677</td>
</tr>
<tr class="even">
<td>Volcán San Martin</td>
<td>1646</td>
</tr>
<tr class="odd">
<td>Tajuya near El Paso</td>
<td>1585</td>
</tr>
<tr class="even">
<td>Montaña Quemada</td>
<td>1492</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p><a href="#tbl-history" class="quarto-xref">Table 4</a> summarises the eruptions recorded since the colonization of the islands by Europeans in the late 1400s.</p>
<div id="fig-map" class="quarto-figure quarto-figure-center quarto-float">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/la-palma-map.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" data-glightbox="description: .lightbox-desc-5"><img src="images/la-palma-map.png" class="img-fluid" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 5: Map of La Palma
</figcaption>
</figure>
</div>
<p>La Palma is one of the west most islands in the Volcanic Archipelago of the Canary Islands (<a href="#fig-map" class="quarto-xref">Figure 5</a>).</p>
<div class="quarto-embed-nb-cell" data-notebook="/mnt/shared/R Work/2024 Data/glowing-system/notebooks/explore-earthquakes.qmd" data-notebook-title="Explore Earthquakes" data-notebook-cellId="cell-fig-spatial-plot">
<div id="cell-fig-spatial-plot" class="cell">
<div class="cell-output cell-output-display">
<div id="fig-spatial-plot" class="quarto-figure quarto-figure-center quarto-float" alt="A scatterplot of earthquake locations plotting latitude against longitude.">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-spatial-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/notebooks-explore-earthquakes-fig-spatial-plot-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" data-glightbox="description: .lightbox-desc-6"><img src="index_files/figure-html/notebooks-explore-earthquakes-fig-spatial-plot-output-1.png" class="img-fluid" alt="A scatterplot of earthquake locations plotting latitude against longitude." /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spatial-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 6: Locations of earthquakes on La Palma since 2017
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p><a href="#fig-spatial-plot" class="quarto-xref">Figure 6</a> shows the location of recent Earthquakes on La Palma.</p>
</section>
<section id="sec-data-methods" class="level2" data-number="9">
<h2 data-number="9"><span class="header-section-number">9</span> Data &amp; Methods</h2>
</section>
<section id="conclusion" class="level2" data-number="10">
<h2 data-number="10"><span class="header-section-number">10</span> Conclusion</h2>
</section>
<section id="references-1" class="level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-barnes_standard_1989" class="csl-entry" role="listitem">
Barnes, R. J., Dhanoa, M. S., &amp; Lister, S. J. (1989). Standard <span>Normal</span> <span>Variate</span> <span>Transformation</span> and <span>De</span>-<span>Trending</span> of <span>Near</span>-<span>Infrared</span> <span>Diffuse</span> <span>Reflectance</span> <span>Spectra</span>. <em>Applied Spectroscopy</em>, <em>43</em>(5), 772–777. <a href="https://doi.org/10.1366/0003702894202201">https://doi.org/10.1366/0003702894202201</a>
</div>
<div id="ref-datatable" class="csl-entry" role="listitem">
Barrett, T., Dowle, M., Srinivasan, A., Gorecki, J., Chirico, M., &amp; Hocking, T. (2024). <em><span class="nocase">data.table</span>: Extension of <span>“<span class="nocase">data.frame</span>”</span></em>. <a href="https://CRAN.R-project.org/package=data.table">https://CRAN.R-project.org/package=data.table</a>
</div>
<div id="ref-barta_proteomic_2024" class="csl-entry" role="listitem">
Bárta, J., Roudnický, P., Jarošová, M., Zdráhal, Z., Stupková, A., Bártová, V., Krejčová, Z., Kyselka, J., Filip, V., Říha, V., Lorenc, F., Bedrníček, J., &amp; Smetana, P. (2024). Proteomic <span>Profiles</span> of <span>Whole</span> <span>Seeds</span>, <span>Hulls</span>, and <span>Dehulled</span> <span>Seeds</span> of <span>Two</span> <span>Industrial</span> <span>Hemp</span> (<span>Cannabis</span> sativa <span>L</span>.) <span>Cultivars</span>. <em>Plants</em>, <em>13</em>(1), 111. <a href="https://doi.org/10.3390/plants13010111">https://doi.org/10.3390/plants13010111</a>
</div>
<div id="ref-bellon-maurel_critical_2010" class="csl-entry" role="listitem">
Bellon-Maurel, V., Fernandez-Ahumada, E., Palagos, B., Roger, J.-M., &amp; McBratney, A. (2010). Critical review of chemometric indicators commonly used for assessing the quality of the prediction of soil attributes by <span>NIR</span> spectroscopy. <em>TrAC Trends in Analytical Chemistry</em>, <em>29</em>(9), 1073–1081. <a href="https://doi.org/10.1016/j.trac.2010.05.006">https://doi.org/10.1016/j.trac.2010.05.006</a>
</div>
<div id="ref-callaway_hempseed_2004" class="csl-entry" role="listitem">
Callaway, J. C. (2004). Hempseed as a nutritional resource: <span>An</span> overview. <em>Euphytica</em>, <em>140</em>(1), 65–72. <a href="https://doi.org/10.1007/s10681-004-4811-6">https://doi.org/10.1007/s10681-004-4811-6</a>
</div>
<div id="ref-chadalavada_nir_2022" class="csl-entry" role="listitem">
Chadalavada, K., Anbazhagan, K., Ndour, A., Choudhary, S., Palmer, W., Flynn, J. R., Mallayee, S., Pothu, S., Prasad, K. V. S. V., Varijakshapanikar, P., Jones, C. S., &amp; Kholová, J. (2022). <span>NIR</span> <span>Instruments</span> and <span>Prediction</span> <span>Methods</span> for <span>Rapid</span> <span>Access</span> to <span>Grain</span> <span>Protein</span> <span>Content</span> in <span>Multiple</span> <span>Cereals</span>. <em>Sensors (Basel, Switzerland)</em>, <em>22</em>(10). <a href="https://doi.org/10.3390/s22103710">https://doi.org/10.3390/s22103710</a>
</div>
<div id="ref-ely_industrial_2022" class="csl-entry" role="listitem">
Ely, K., &amp; Fike, J. (2022). Industrial <span>Hemp</span> and <span>Hemp</span> <span>Byproducts</span> as <span>Sustainable</span> <span>Feedstuffs</span> in <span>Livestock</span> <span>Diets</span>. In D. C. Agrawal, R. Kumar, &amp; M. Dhanasekaran (Eds.), <em>Cannabis/<span>Hemp</span> for <span>Sustainable</span> <span>Agriculture</span> and <span>Materials</span></em> (pp. 145–162). Springer. <a href="https://doi.org/10.1007/978-981-16-8778-5_6">https://doi.org/10.1007/978-981-16-8778-5_6</a>
</div>
<div id="ref-garrido-varo_note_2019" class="csl-entry" role="listitem">
Garrido-Varo, A., Garcia-Olmo, J., &amp; Fearn, T. (2019). A note on <span>Mahalanobis</span> and related distance measures in <span>WinISI</span> and <span>The</span> <span>Unscrambler</span>. <em>Journal of Near Infrared Spectroscopy</em>, <em>27</em>(4), 253–258. <a href="https://doi.org/10.1177/0967033519848296">https://doi.org/10.1177/0967033519848296</a>
</div>
<div id="ref-geyer_genetics_2022" class="csl-entry" role="listitem">
Geyer, M., Mohler, V., &amp; Hartl, L. (2022). Genetics of the <span>Inverse</span> <span>Relationship</span> between <span>Grain</span> <span>Yield</span> and <span>Grain</span> <span>Protein</span> <span>Content</span> in <span>Common</span> <span>Wheat</span>. <em>Plants</em>, <em>11</em>(16), 2146. <a href="https://doi.org/10.3390/plants11162146">https://doi.org/10.3390/plants11162146</a>
</div>
<div id="ref-giancaspro_genetic_2019" class="csl-entry" role="listitem">
Giancaspro, A., Giove, S. L., Blanco, A., &amp; Gadaleta, A. (2019). Genetic <span>Variation</span> for <span>Protein</span> <span>Content</span> and <span>Yield</span>-<span>Related</span> <span>Traits</span> in a <span>Durum</span> <span>Population</span> <span>Derived</span> <span>From</span> an <span>Inter</span>-<span>Specific</span> <span>Cross</span> <span>Between</span> <span>Hexaploid</span> and <span>Tetraploid</span> <span>Wheat</span> <span>Cultivars</span>. <em>Frontiers in Plant Science</em>, <em>10</em>. <a href="https://doi.org/10.3389/fpls.2019.01509">https://doi.org/10.3389/fpls.2019.01509</a>
</div>
<div id="ref-hayes_measuring_2020" class="csl-entry" role="listitem">
Hayes, M. (2020). Measuring <span>Protein</span> <span>Content</span> in <span>Food</span>: <span>An</span> <span>Overview</span> of <span>Methods</span>. <em>Foods</em>, <em>9</em>(10), 1340. <a href="https://doi.org/10.3390/foods9101340">https://doi.org/10.3390/foods9101340</a>
</div>
<div id="ref-tidymodels" class="csl-entry" role="listitem">
Kuhn, M., &amp; Wickham, H. (2020). <em><span>Tidymodels</span>: A collection of packages for modeling and machine learning using tidyverse principles.</em> <a href="https://www.tidymodels.org">https://www.tidymodels.org</a>
</div>
<div id="ref-caret" class="csl-entry" role="listitem">
Kuhn, &amp; Max. (2008). Building predictive models in r using the caret package. <em>Journal of Statistical Software</em>, <em>28</em>(5), 1–26. <a href="https://doi.org/10.18637/jss.v028.i05">https://doi.org/10.18637/jss.v028.i05</a>
</div>
<div id="ref-emmeans" class="csl-entry" role="listitem">
Lenth, R. V. (2024). <em><span class="nocase">emmeans</span>: Estimated marginal means, aka least-squares means</em>. <a href="https://CRAN.R-project.org/package=emmeans">https://CRAN.R-project.org/package=emmeans</a>
</div>
<div id="ref-li_quantitative_2020" class="csl-entry" role="listitem">
Li, Y., Huang, Y., Xia, J., Xiong, Y., &amp; Min, S. (2020). Quantitative analysis of honey adulteration by spectrum analysis combined with several high-level data fusion strategies. <em>Vibrational Spectroscopy</em>, <em>108</em>, 103060. <a href="https://doi.org/10.1016/j.vibspec.2020.103060">https://doi.org/10.1016/j.vibspec.2020.103060</a>
</div>
<div id="ref-pls" class="csl-entry" role="listitem">
Liland, K. H., Mevik, B.-H., &amp; Wehrens, R. (2023). <em><span class="nocase">pls</span>: Partial least squares and principal component regression</em>. <a href="https://CRAN.R-project.org/package=pls">https://CRAN.R-project.org/package=pls</a>
</div>
<div id="ref-luo_properties_2005" class="csl-entry" role="listitem">
Luo, J., Ying, K., He, P., &amp; Bai, J. (2005). Properties of <span>Savitzky</span>–<span>Golay</span> digital differentiators. <em>Digital Signal Processing</em>, <em>15</em>(2), 122–136. <a href="https://doi.org/10.1016/j.dsp.2004.09.008">https://doi.org/10.1016/j.dsp.2004.09.008</a>
</div>
<div id="ref-nlme2000" class="csl-entry" role="listitem">
Pinheiro, J. C., &amp; Bates, D. M. (2000). <em>Mixed-effects models in s and s-PLUS</em>. Springer. <a href="https://doi.org/10.1007/b98882">https://doi.org/10.1007/b98882</a>
</div>
<div id="ref-nlme2023" class="csl-entry" role="listitem">
Pinheiro, J., Bates, D., &amp; R Core Team. (2023). <em><span class="nocase">nlme</span>: Linear and nonlinear mixed effects models</em>. <a href="https://CRAN.R-project.org/package=nlme">https://CRAN.R-project.org/package=nlme</a>
</div>
<div id="ref-base" class="csl-entry" role="listitem">
R Core Team. (2024). <em><span>R</span>: A language and environment for statistical computing</em>. R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>
</div>
<div id="ref-reeves_potential_2012" class="csl-entry" role="listitem">
Reeves, J. B. (2012). Potential of <span>Near</span>- and <span>Mid</span>-infrared <span>Spectroscopy</span> in <span>Biofuel</span> <span>Production</span>. <em>Communications in Soil Science and Plant Analysis</em>, <em>43</em>(1-2), 478–495. <a href="https://doi.org/10.1080/00103624.2012.641844">https://doi.org/10.1080/00103624.2012.641844</a>
</div>
<div id="ref-roberts_near-infrared_2004" class="csl-entry" role="listitem">
Roberts, C. A., Workman, J., &amp; Reeves, J. B. (2004). <em>Near-infrared spectroscopy in agriculture</em>. American Society of Agronomy.
</div>
<div id="ref-prospectr" class="csl-entry" role="listitem">
Stevens, A., &amp; Ramirez-Lopez, L. (2024). <em>An introduction to the prospectr package</em>.
</div>
<div id="ref-skimr" class="csl-entry" role="listitem">
Waring, E., Quinn, M., McNamara, A., Arino de la Rubia, E., Zhu, H., &amp; Ellis, S. (2022). <em><span class="nocase">skimr</span>: Compact and flexible summaries of data</em>. <a href="https://CRAN.R-project.org/package=skimr">https://CRAN.R-project.org/package=skimr</a>
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, H., Averick, M., Bryan, J., Chang, W., McGowan, L. D., François, R., Grolemund, G., Hayes, A., Henry, L., Hester, J., Kuhn, M., Pedersen, T. L., Miller, E., Bache, S. M., Müller, K., Ooms, J., Robinson, D., Seidel, D. P., Spinu, V., … Yutani, H. (2019). Welcome to the <span class="nocase">tidyverse</span>. <em>Journal of Open Source Software</em>, <em>4</em>(43), 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>
</div>
<div id="ref-williams_application_1975" class="csl-entry" role="listitem">
Williams, P. C. (1975). Application of near infrared reflectance spectroscopy to analysis of cereal grains and oilseeds. <em>Cereal Chemistry</em>, <em>52</em>(4 p.561-576), 576–561.
</div>
<div id="ref-wold_pls-regression_2001" class="csl-entry" role="listitem">
Wold, S., Sjöström, M., &amp; Eriksson, L. (2001). <span>PLS</span>-regression: A basic tool of chemometrics. <em>Chemometrics and Intelligent Laboratory Systems</em>, <em>58</em>(2), 109–130. <a href="https://doi.org/10.1016/S0169-7439(01)00155-1">https://doi.org/10.1016/S0169-7439(01)00155-1</a>
</div>
</div>
<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">Figure 1: Decreasing RMSE with increasing number of PCs</span>
<span class="glightbox-desc lightbox-desc-2">Figure 2: Final model validation set performance (1000 iterations)</span>
<span class="glightbox-desc lightbox-desc-3">Figure 3: Test set prediction errors on a per-sample basis. Actual sample value set to 0, and samples ranked from least to greatest actual % CP value</span>
<span class="glightbox-desc lightbox-desc-4">Figure 4: Timeline of recent earthquakes on La Palma</span>
<span class="glightbox-desc lightbox-desc-5">Figure 5: Map of La Palma</span>
<span class="glightbox-desc lightbox-desc-6">Figure 6: Locations of earthquakes on La Palma since 2017</span>
</div>
</section>

</main>
<!-- /main column -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"loop":false,"descPosition":"bottom","selector":".lightbox","openEffect":"zoom","closeEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>

</body>

</html>
