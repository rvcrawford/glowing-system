<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving
and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">

<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">

<front>


<article-meta>


<title-group>
<article-title>Near Infra-Red Spectroscopy Predicts Crude Protein in
Hemp Grain</article-title>
</title-group>

<contrib-group>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Crawford</surname>
<given-names>Ryan</given-names>
</name>
<string-name>Ryan Crawford</string-name>

<email>rvc3@cornell.edu</email>
<xref ref-type="aff" rid="aff-1">a</xref>
<xref ref-type="corresp" rid="cor-1">&#x002A;</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Crawford</surname>
<given-names>Jamie</given-names>
</name>
<string-name>Jamie Crawford</string-name>

<xref ref-type="aff" rid="aff-1">a</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Smart</surname>
<given-names>Lawrence B.</given-names>
</name>
<string-name>Lawrence B. Smart</string-name>

<xref ref-type="aff" rid="aff-2">b</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Moore</surname>
<given-names>Virginia</given-names>
</name>
<string-name>Virginia Moore</string-name>

<xref ref-type="aff" rid="aff-3">c</xref>
</contrib>
</contrib-group>
<aff id="aff-1">
<institution-wrap>
<institution>Cornell University</institution>
</institution-wrap>
<addr-line>126 Medicago Drive</addr-line>
<city>Ithaca</city>
<state>NY</state>

<postal-code>14853</postal-code>


</aff>
<aff id="aff-2">
<institution-wrap>
<institution>Cornell AgriTech</institution>
</institution-wrap>
<addr-line>102 Hedrick Hall</addr-line>
<city>Geneva</city>
<state>NY</state>

<postal-code>14456</postal-code>


</aff>
<aff id="aff-3">
<institution-wrap>
<institution>Cornell University</institution>
</institution-wrap>
<addr-line>162 Emerson Hall</addr-line>
<city>Ithaca</city>
<state>NY</state>

<postal-code>14853</postal-code>


</aff>
<author-notes>
<corresp id="cor-1">rvc3@cornell.edu</corresp>
</author-notes>









<history></history>


<abstract>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
ex ea commodo consequat. Duis aute irure dolor in reprehenderit in
voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur
sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt
mollit anim id est laborum.</p>
</abstract>
<kwd-group kwd-group-type="author">
<kwd>Hemp</kwd>
<kwd>Grain</kwd>
<kwd>Spectroscopy</kwd>
</kwd-group>




</article-meta>

</front>

<body>
<p><bold>incomplete: may contain errors, run-ons, half-thoughts,
etc.</bold></p>
<sec id="introduction">
  <title>INTRODUCTION</title>
  <p>Hemp (Cannabis sativa L.) is an annual crop with potential uses as
  a source of food or feed from grain, and bast fiber or hurd from the
  stalk. Hemp cultivars are commonly grown for one or both purposes and
  a cultivar may be referred to as a grain, fiber, or dual-purpose type.
  Because of protein’s nutritional importance, the protein content of a
  grain crop is an prime consideration for researchers, producers, and
  consumers. Whole hemp grain typically contains approximately 20-30%
  protein
  (<xref alt="Ely and Fike 2022" rid="ref-ely_industrial_2022" ref-type="bibr">Ely
  and Fike 2022</xref>;
  <xref alt="Bárta et al. 2024" rid="ref-barta_proteomic_2024" ref-type="bibr">Bárta
  et al. 2024</xref>;
  <xref alt="callaway2004?" rid="ref-callaway2004" ref-type="bibr"><bold>callaway2004?</bold></xref>).
  Crude protein (CP) is often used as a proxy for the direct measurement
  of protein concentration and consists of the multiplication of
  nitrogen concentration by a conversion factor because measuring
  nitrogen concentration is relatively easy and cheap via laboratory
  assay
  (<xref alt="Hayes 2020" rid="ref-hayes_measuring_2020" ref-type="bibr">Hayes
  2020</xref>).</p>
  <p>Near-infrared spectroscopy (NIRS) technology is rapid,
  non-destructive, and cheap, and consists of the measurement of NIR
  radiation reflected from a sample
  (<xref alt="Roberts, Workman, and Reeves 2004" rid="ref-roberts_near-infrared_2004" ref-type="bibr">Roberts,
  Workman, and Reeves 2004</xref>). NIR spectra from many samples are
  related to laboratory values for components such as moisture, protein,
  fat, or fiber
  (<xref alt="Roberts, Workman, and Reeves 2004" rid="ref-roberts_near-infrared_2004" ref-type="bibr">Roberts,
  Workman, and Reeves 2004</xref>). NIRS technology has been used since
  the 1970’s to assess forage CP
  (<xref alt="Reeves 2012" rid="ref-reeves_potential_2012" ref-type="bibr">Reeves
  2012</xref>;
  <xref alt="Williams 1975" rid="ref-williams_application_1975" ref-type="bibr">Williams
  1975</xref>). A NIRS calibration set often consists of samples from
  one species grown in many environments encompassing the range of
  expected values from the analyte or analytes
  (<xref alt="Chadalavada et al. 2022" rid="ref-chadalavada_nir_2022" ref-type="bibr">Chadalavada
  et al. 2022</xref>). Partial least squares regression (PLSR) is a
  typical method used in the agricultural and food sciences to relate
  spectra to analyte
  (<xref alt="Roberts, Workman, and Reeves 2004" rid="ref-roberts_near-infrared_2004" ref-type="bibr">Roberts,
  Workman, and Reeves 2004</xref>). PLSR calculates principal components
  (PCs) which relate to the dependent variable and summarize the spectra
  and uses a subset of PCs in order to fit the regression model. PLSR is
  commonly used in spectroscopy because it tends to work well with
  highly-correlated spectral data. Typically the number of principal
  components is chosen via cross-validation to avoid overfitting.
  <bold>CITES FOR ALL OF THIS</bold></p>
  <p>A NIRS-scanned sample of undamaged grain may subsequently be grown,
  an important consideration for a plant breeder. In wheat and corn,
  grain protein content has been shown to be heritable
  (<xref alt="Giancaspro et al. 2019" rid="ref-giancaspro_genetic_2019" ref-type="bibr">Giancaspro
  et al. 2019</xref>;
  <xref alt="Geyer, Mohler, and Hartl 2022" rid="ref-geyer_genetics_2022" ref-type="bibr">Geyer,
  Mohler, and Hartl 2022</xref>). This suggests (at least potentially)
  that NIRS technology could serve as resource to more rapidly identify
  high CP hemp germplasm, enabling the delivery of higher CP hemp grain
  cultivars faster.</p>
  <p>For this study, a benchtop NIR spectrometer was used to develop a
  model to predict CP content based on a data set of hemp grain
  representing multiple years, locations, and cultivars from grain and
  dual-purpose hemp types using PLSR.</p>
</sec>
<sec id="materials-and-methods">
  <title>MATERIALS AND METHODS</title>
  <sec id="hemp-grain-sample-background">
    <title>Hemp Grain Sample Background</title>
    <p>Spectral data were obtained from whole (unground) hemp grain
    samples, harvested at maturity, collected from 2017 - 2021 from 18
    cultivar trials in New York (NY) (NA samples). Grain samples were
    obtained by hand sampling or mechanical harvest and were cleaned of
    chaff and dried at 30 C for six days in a forced-air dryer. In
    total, 38 cultivars were represented in the data set. Cultivars were
    grain or dual-purpose types and included both commercially available
    and experimental material.</p>
    <p>All cultivar trials were planted in randomized complete block
    design with each cultivar replicated four times. The 2017 data were
    comprised of samples from the same thirteen cultivars sampled from
    six NY locations. For those trials, grain was harvested from each
    plot individually and aggregated by cultivar within each trial. Four
    subsamples were drawn from each aggregated sample and scanned
    separately. These spectra were averaged at each 2 nm increment. All
    remaining samples from 2018-2021 were collected on a per-plot basis.
    All possible cultivars and possible locations were represented in
    2017, but only a selected subset of cultivars and locations were
    represented in 2018-2021.</p>
  </sec>
  <sec id="spectral-data-collection-and-preprocessing">
    <title>Spectral Data Collection and Preprocessing</title>
    <p>A benchtop NIR spectrometer (FOSS/ NIR FOSS/ NIR Systems model
    5000) was used to obtain the spectra (FOSS North America, Eden
    Prairie, MN, USA). Spectra were collected every 2 nm from 1100-2498
    nm and the logarithm of reciprocal reflectance was recorded.</p>
    <p>WINISI software version 1.02A (Infrasoft International, Port
    Matilda, PA, USA) was used to average the spectra in 2017, as well
    as to select samples for laboratory assay. Samples were selected
    according to their spectral distance from their nearest neighbor
    within the calibration data set with a cutoff of a distance of 0.6
    H, where H is approximately equal to the squared Mahalanobis
    distance divided by the number of principal components used in the
    calculation
    (<xref alt="Garrido-Varo, Garcia-Olmo, and Fearn 2019" rid="ref-garrido-varo_note_2019" ref-type="bibr">Garrido-Varo,
    Garcia-Olmo, and Fearn 2019</xref>). Prior to selection selection,
    spectra were preprocessed using SNV-detrend with settings 1,4,4,1
    for the derivative, gap, smooth, and smooth 2 settings
    respectively.</p>
  </sec>
  <sec id="laboratory-validation">
    <title>Laboratory Validation</title>
    <p>Laboratory assays were performed by Dairy One Forage Laboratory
    (Ithaca, NY). For those assays, 1mm ground samples were analyzed by
    combustion using a CN628 or CN928 Carbon/Nitrogen Determinator.
    Samples from 2017 were aggregated as described above, but the
    remaining samples were not aggregated.</p>
  </sec>
  <sec id="model-development">
    <title>Model Development</title>
    <p>Calibration and validations sets were created by dividing the
    laboratory CP values into tertiles according to their percent CP in
    order to ensure that the range of CP values was present in both
    calibration and validation sets. Within each tertile, 75% of the
    samples were randomly assigned to the calibration set and the
    remaining 25% were assigned to the validation set. For each
    calibration set, models were developed in caret using PLSR. In
    fitting the model, the number of principal components was optimized
    over au grid search from 1-20. Model performance was evaluated with
    25 iterations of bootstrapping and minimized root mean squared error
    (RMSE) in selecting the number of principal components in the final
    model
    (<xref alt="kuhn2008?" rid="ref-kuhn2008" ref-type="bibr"><bold>kuhn2008?</bold></xref>).</p>
    <p>Initially a number of common spectral preprocessing methods were
    tested by creating 100 calibration and validation sets as described
    above. Spectral data from those data sets were transformed by each
    of the following methods: 1) first derivative, 2) Savitzky-Golay
    (SG), 3) gap-segment derivative, 4) standard normal variate (SNV),
    4) standard normal variate following Savitzky-Golay (SNV-SG), 5)
    SNV-detrend, and 6) multiplicative scatter correction. For each of
    these preprocessing methods, models were fit and predictions were
    made on the corresponding validation set (since there were 8
    preprocessing methods, 8 separate models were fit for each of the
    100 sets. The relationship between the predicted and actual values
    of the validation set were calculated via RMSE, R<sup>2</sup> and
    Ratio of Performance to InterQuartile distance (RPIQ), three common
    model assessment metrics. Analyses of variance (ANOVA) were
    performed for each of these metrics in order to compare the
    preprocessing methods. For each ANOVA, each data set was considered
    as a subject and allowing different variances for each preprocessing
    method.</p>
    <p>Once the most promising preprocessing method was identified, 1000
    more data sets were created and analyzed via that method and
    performance on the validation sets was summarized with RMSE,
    R<sup>2</sup>, and RPIQ.</p>
  </sec>
  <sec id="additional-software-used">
    <title>Additional software used</title>
    <p>We used R version 4.3.3
    (<xref alt="R Core Team 2024" rid="ref-base" ref-type="bibr">R Core
    Team 2024</xref>) and the following R packages: caret v. 6.0.94
    (<xref alt="Kuhn and Max 2008" rid="ref-caret" ref-type="bibr">Kuhn
    and Max 2008</xref>), data.table v. 1.15.2
    (<xref alt="Barrett et al. 2024" rid="ref-datatable" ref-type="bibr">Barrett
    et al. 2024</xref>), emmeans v. 1.10.0
    (<xref alt="Lenth 2024" rid="ref-emmeans" ref-type="bibr">Lenth
    2024</xref>), knitr v. 1.45
    (<xref alt="Xie 2014" rid="ref-knitr2014" ref-type="bibr">Xie
    2014</xref>,
    <xref alt="2015" rid="ref-knitr2015" ref-type="bibr">2015</xref>,
    <xref alt="2023" rid="ref-knitr2023" ref-type="bibr">2023</xref>),
    lme4 v. 1.1.35.1
    (<xref alt="Bates et al. 2015" rid="ref-lme4" ref-type="bibr">Bates
    et al. 2015</xref>), multcomp v. 1.4.25
    (<xref alt="Hothorn, Bretz, and Westfall 2008" rid="ref-multcomp" ref-type="bibr">Hothorn,
    Bretz, and Westfall 2008</xref>), nlme v. 3.1.163
    (<xref alt="J. C. Pinheiro and Bates 2000" rid="ref-nlme2000" ref-type="bibr">J.
    C. Pinheiro and Bates 2000</xref>;
    <xref alt="J. Pinheiro, Bates, and R Core Team 2023" rid="ref-nlme2023" ref-type="bibr">J.
    Pinheiro, Bates, and R Core Team 2023</xref>), pls v. 2.8.3
    (<xref alt="Liland, Mevik, and Wehrens 2023" rid="ref-pls" ref-type="bibr">Liland,
    Mevik, and Wehrens 2023</xref>), prospectr v. 0.2.7
    (<xref alt="Stevens and Ramirez-Lopez 2024" rid="ref-prospectr" ref-type="bibr">Stevens
    and Ramirez-Lopez 2024</xref>), randomForest v. 4.7.1.1
    (<xref alt="Liaw and Wiener 2002" rid="ref-randomForest" ref-type="bibr">Liaw
    and Wiener 2002</xref>), rmarkdown v. 2.26
    (<xref alt="Xie, Allaire, and Grolemund 2018" rid="ref-rmarkdown2018" ref-type="bibr">Xie,
    Allaire, and Grolemund 2018</xref>;
    <xref alt="Xie, Dervieux, and Riederer 2020" rid="ref-rmarkdown2020" ref-type="bibr">Xie,
    Dervieux, and Riederer 2020</xref>;
    <xref alt="Allaire et al. 2024" rid="ref-rmarkdown2024" ref-type="bibr">Allaire
    et al. 2024</xref>), skimr v. 2.1.5
    (<xref alt="Waring et al. 2022" rid="ref-skimr" ref-type="bibr">Waring
    et al. 2022</xref>), tidymodels v. 1.1.1
    (<xref alt="Kuhn and Wickham 2020" rid="ref-tidymodels" ref-type="bibr">Kuhn
    and Wickham 2020</xref>), tidyverse v. 2.0.0
    (<xref alt="Wickham et al. 2019" rid="ref-tidyverse" ref-type="bibr">Wickham
    et al. 2019</xref>).</p>
  </sec>
</sec>
<sec id="results-and-discussion">
  <title>RESULTS AND DISCUSSION</title>
  <sec id="laboratory-assay-cp-values">
    <title>Laboratory assay CP values</title>
    <p>Laboratory assay percent CP values are summarized in the
    following table. These are similar to the range of CP values
    observed in the literature, indicating an appropriate basis for a
    chemometric model. The CP values are left-skewed and two thirds of
    the samples contained more than 25% CP.</p>
    <fig id="tbl-lab-protein-vals">
      <caption><p>Table 1: Summary of Laboratory Assayed CP Values
      (Percent Dry Matter)</p></caption>
      <table-wrap>
        <table>
          <thead>
            <tr>
              <th align="right">Mean</th>
              <th align="right">Sd</th>
              <th align="right">Minimum</th>
              <th align="right">First Quartile</th>
              <th align="right">Median</th>
              <th align="right">Third Quartile</th>
              <th align="right">Maximum</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="right">26.1</td>
              <td align="right">2.5</td>
              <td align="right">20.8</td>
              <td align="right">23.9</td>
              <td align="right">26.4</td>
              <td align="right">28.2</td>
              <td align="right">30.8</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </fig>
  </sec>
  <sec id="preprocessing-methods-comparison">
    <title>Preprocessing methods comparison</title>
    <p>All preprocessing methods outperformed raw spectral data
    <xref alt="Table 2" rid="tbl-preproc">Table 2</xref>. Averaged
    together, all preprocessed spectra were superior to raw spectra,
    with lower RMSE, and higher R<sup>2</sup> and RPIQ values
    (significant at <inline-formula><alternatives>
    <tex-math><![CDATA[\alpha]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>α</mml:mi></mml:math></alternatives></inline-formula>
    level &lt;0.001). Preprocessing methods had -11.6 % lower RMSE, and
    had 3.1% higher R<sup>2</sup> 7.4% higher RPIQ than unprocessed
    spectra.</p>
    <p>The SNV-SG method had the lowest RMSE, highest R<sup>2</sup>, and
    highest RPIQ averaging over all iterations. SNV-SG RMSE averaged
    1.4% lower, while R<sup>2</sup> and RPIQ averaged 0.4% and 2.4%
    higher respectively than the next best preprocessing method (SG in
    both cases), but the difference between the best and second best
    method by metric were only statistically significant at
    <inline-formula><alternatives>
    <tex-math><![CDATA[\alpha]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>α</mml:mi></mml:math></alternatives></inline-formula>
    &lt;0.05 for RPIQ. RPIQ was devised to accurately reflect the spread
    of data in skewed populations
    (<xref alt="Bellon-Maurel et al. 2010" rid="ref-bellon-maurel2010" ref-type="bibr">Bellon-Maurel
    et al. 2010</xref>) and thus offers a robust metric for model
    assessment. Therefore the superiority of SNV-SG as measured via RPIQ
    made it the superior candidate for the choice of final model.</p>
    <fig id="tbl-preproc">
      <caption><p>Table 2: Evaluation of Preprocessing Methods by
      Metric</p></caption>
      <table-wrap>
        <table>
          <colgroup>
            <col width="56%" />
            <col width="15%" />
            <col width="15%" />
            <col width="15%" />
          </colgroup>
          <thead>
            <tr>
              <th align="left">Preprocessing Method</th>
              <th align="left">RMSE</th>
              <th align="left"><inline-formula><alternatives>
              <tex-math><![CDATA[R^{2}]]></tex-math>
              <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math></alternatives></inline-formula></th>
              <th align="left">RPIQ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">Standard Normal Variate following
              Savitzky-Golay</td>
              <td align="left">1.02 ± 0.012</td>
              <td align="left">0.84 ± 0.004</td>
              <td align="left">3.97 ± 0.076</td>
            </tr>
            <tr>
              <td align="left">Savitzky-Golay</td>
              <td align="left">1.03 ± 0.012</td>
              <td align="left">0.83 ± 0.004</td>
              <td align="left">3.88 ± 0.072</td>
            </tr>
            <tr>
              <td align="left">First Derivative</td>
              <td align="left">1.07 ± 0.013</td>
              <td align="left">0.82 ± 0.004</td>
              <td align="left">3.77 ± 0.075</td>
            </tr>
            <tr>
              <td align="left">Standard Normal Variate</td>
              <td align="left">1.12 ± 0.016</td>
              <td align="left">0.80 ± 0.005</td>
              <td align="left">3.61 ± 0.081</td>
            </tr>
            <tr>
              <td align="left">Gap-segment Derivative</td>
              <td align="left">1.12 ± 0.018</td>
              <td align="left">0.81 ± 0.006</td>
              <td align="left">3.60 ± 0.086</td>
            </tr>
            <tr>
              <td align="left">Standard Normal Variate-Detrend</td>
              <td align="left">1.13 ± 0.015</td>
              <td align="left">0.80 ± 0.005</td>
              <td align="left">3.55 ± 0.079</td>
            </tr>
            <tr>
              <td align="left">Multiplicative Scatter Correction</td>
              <td align="left">1.17 ± 0.016</td>
              <td align="left">0.79 ± 0.006</td>
              <td align="left">3.47 ± 0.080</td>
            </tr>
            <tr>
              <td align="left">Raw Spectra</td>
              <td align="left">1.22 ± 0.044</td>
              <td align="left">0.79 ± 0.009</td>
              <td align="left">3.42 ± 0.105</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </fig>
    <p><bold>paragraph discussing relative merits of various
    preprocessing methods</bold></p>
    <p>The preprocessing methods examined represent a portion of those
    available. As well, preprocessing methods tend to have a number of
    user-adjustable parameters whose various permutations were not
    tested. This subset of preprocessing methods and parameters
    nonetheless contained substantial variations in model quality,
    demonstrating the importance of the selection an appropriate
    preprocessing method.</p>
  </sec>
  <sec id="final-model-development-and-summary">
    <title>Final model development and summary</title>
    <p>The model improved most rapidly as the number of principal
    components increased from 1 to 7, with the inclusion of each
    additional PC being associated with a decrease in RMSE of 5-12% .
    From 8 to 12 PCs, model performance continued to improve, although
    gains were more modest (decrease in RMSE of 0.7-3%). With 13 or more
    PCs, performance gains were minimal and the relative ranks of the
    models tended to be stable
    <xref alt="Figure 1" rid="fig-model-calibration">Figure 1</xref>.</p>
    <fig id="fig-model-calibration">
      <caption><p>Figure 1: Decreasing RMSE with increasing number of
      PCs</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-model-calibration-1.png" />
    </fig>
    <fig id="fig-final-metric-boxplot">
      <caption><p>Figure 2: Final model validation set performance (1000
      iterations)</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-final-metric-boxplot-1.png" />
    </fig>
    <fig id="fig-validation_set_performance">
      <caption><p>Figure 3: Test set predictions versus normalized
      scores across hemp samples</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-validation_set_performance-1.png" />
    </fig>
    <p>Errors tend to be lower at higher levels of actual CP</p>
    <p>This study is limited in that it represents the creation of one
    model based upon spectra collected from one machine. NIRS
    calibrations can be unique to a particular machine, even if the
    machines compared are of the same model
    (<xref alt="reeves2012?" rid="ref-reeves2012" ref-type="bibr"><bold>reeves2012?</bold></xref>).
    As well, the calibration and validation sets are relatively
    small.</p>
    <p>This research showed the promise of the use of NIRS in order to
    make predictions concerning %CP in hemp grain using PLS. Promising
    preprocessing methods were identified and a model was validated.
    Further research could refine the model by including more samples or
    by examining other predictive methods.</p>
  </sec>
</sec>
<sec id="acknowledgments">
  <title>ACKNOWLEDGMENTS</title>
</sec>
<sec id="supplemental-material">
  <title>SUPPLEMENTAL MATERIAL</title>
</sec>
<sec id="optional-sections">
  <title>OPTIONAL SECTIONS</title>
</sec>
<sec id="references">
  <title>REFERENCES</title>
</sec>
<sec id="figures-and-tables">
  <title>FIGURES AND TABLES</title>
  <fig id="fig-timeline">
    <caption><p>Figure 4: Timeline of recent earthquakes on La
    Palma</p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-timeline-1.png" />
  </fig>
  <p>Based on data up to and including 1971, eruptions on La Palma
  happen every 79.8 years on average.</p>
  <p>Studies of the magma systems feeding the volcano, such as
  (<xref alt="marrero2019?" rid="ref-marrero2019" ref-type="bibr"><bold>marrero2019?</bold></xref>),
  have proposed that there are two main magma reservoirs feeding the
  Cumbre Vieja volcano; one in the mantle (30-40km depth) which charges
  and in turn feeds a shallower crustal reservoir (10-20km depth).</p>
  <p>Eight eruptions have been recorded since the late 1400s
  (<xref alt="Figure 4" rid="fig-timeline">Figure 4</xref>).</p>
  <p>Data and methods are discussed in
  <xref alt="Section 9" rid="sec-data-methods">Section 9</xref>.</p>
  <p>Let <inline-formula><alternatives>
  <tex-math><![CDATA[x]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
  denote the number of eruptions in a year. Then,
  <inline-formula><alternatives>
  <tex-math><![CDATA[x]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
  can be modeled by a Poisson distribution</p>
  <p><styled-content id="eq-poisson"><disp-formula><alternatives>
  <tex-math><![CDATA[
  p(x) = \frac{e^{-\lambda} \lambda^{x}}{x !}
   \qquad(1)]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mi>λ</mml:mi><mml:mi>x</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mi>!</mml:mi></mml:mrow></mml:mfrac><mml:mspace width="2.0em"></mml:mspace><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula></styled-content></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[\lambda]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>λ</mml:mi></mml:math></alternatives></inline-formula>
  is the rate of eruptions per year. Using
  <xref alt="Equation 1" rid="eq-poisson">Equation 1</xref>, the
  probability of an eruption in the next <inline-formula><alternatives>
  <tex-math><![CDATA[t]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>t</mml:mi></mml:math></alternatives></inline-formula>
  years can be calculated.</p>
  <fig id="tbl-history">
    <caption><p>Table 3: Recent historic eruptions on La
    Palma</p></caption>
    <table-wrap>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Year</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Current</td>
            <td>2021</td>
          </tr>
          <tr>
            <td>Teneguía</td>
            <td>1971</td>
          </tr>
          <tr>
            <td>Nambroque</td>
            <td>1949</td>
          </tr>
          <tr>
            <td>El Charco</td>
            <td>1712</td>
          </tr>
          <tr>
            <td>Volcán San Antonio</td>
            <td>1677</td>
          </tr>
          <tr>
            <td>Volcán San Martin</td>
            <td>1646</td>
          </tr>
          <tr>
            <td>Tajuya near El Paso</td>
            <td>1585</td>
          </tr>
          <tr>
            <td>Montaña Quemada</td>
            <td>1492</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
  </fig>
  <p><xref alt="Table 3" rid="tbl-history">Table 3</xref> summarises the
  eruptions recorded since the colonization of the islands by Europeans
  in the late 1400s.</p>
  <fig id="fig-map">
    <caption><p>Figure 5: Map of La Palma</p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="images/la-palma-map.png" />
  </fig>
  <p>La Palma is one of the west most islands in the Volcanic
  Archipelago of the Canary Islands
  (<xref alt="Figure 5" rid="fig-map">Figure 5</xref>).</p>
  <fig id="fig-spatial-plot">
    <caption><p>Figure 6: Locations of earthquakes on La Palma since
    2017</p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/notebooks-explore-earthquakes-fig-spatial-plot-output-1.png" />
  </fig>
  <p><xref alt="Figure 6" rid="fig-spatial-plot">Figure 6</xref> shows
  the location of recent Earthquakes on La Palma.</p>
</sec>
<sec id="sec-data-methods">
  <title>Data &amp; Methods</title>
</sec>
<sec id="conclusion">
  <title>Conclusion</title>
</sec>
</body>

<back>
<ref-list>
  <title>References</title>
  <ref id="ref-chadalavada_nir_2022">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Chadalavada</surname><given-names>Keerthi</given-names></name>
        <name><surname>Anbazhagan</surname><given-names>Krithika</given-names></name>
        <name><surname>Ndour</surname><given-names>Adama</given-names></name>
        <name><surname>Choudhary</surname><given-names>Sunita</given-names></name>
        <name><surname>Palmer</surname><given-names>William</given-names></name>
        <name><surname>Flynn</surname><given-names>Jamie R</given-names></name>
        <name><surname>Mallayee</surname><given-names>Srikanth</given-names></name>
        <name><surname>Pothu</surname><given-names>Sharada</given-names></name>
        <name><surname>Prasad</surname><given-names>Kodukula Venkata Subrahamanya Vara</given-names></name>
        <name><surname>Varijakshapanikar</surname><given-names>Padmakumar</given-names></name>
        <name><surname>Jones</surname><given-names>Chris S</given-names></name>
        <name><surname>Kholová</surname><given-names>Jana</given-names></name>
      </person-group>
      <article-title>NIR Instruments and Prediction Methods for Rapid Access to Grain Protein Content in Multiple Cereals.</article-title>
      <source>Sensors (Basel, Switzerland)</source>
      <year iso-8601-date="2022-05">2022</year><month>05</month>
      <volume>22</volume>
      <issue>10</issue>
      <issn>1424-8220</issn>
      <pub-id pub-id-type="doi">10.3390/s22103710</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-reeves_potential_2012">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Reeves</surname><given-names>James B.</given-names></name>
      </person-group>
      <article-title>Potential of Near- and Mid-infrared Spectroscopy in Biofuel Production</article-title>
      <source>Communications in Soil Science and Plant Analysis</source>
      <year iso-8601-date="2012-01">2012</year><month>01</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-03-15">2023</year><month>03</month><day>15</day></date-in-citation>
      <volume>43</volume>
      <issue>1-2</issue>
      <issn>0010-3624</issn>
      <uri>https://doi.org/10.1080/00103624.2012.641844</uri>
      <pub-id pub-id-type="doi">10.1080/00103624.2012.641844</pub-id>
      <fpage>478</fpage>
      <lpage>495</lpage>
    </element-citation>
  </ref>
  <ref id="ref-roberts_near-infrared_2004">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Roberts</surname><given-names>Craig A</given-names></name>
        <name><surname>Workman</surname><given-names>Jerry</given-names></name>
        <name><surname>Reeves</surname><given-names>James B</given-names></name>
      </person-group>
      <source>Near-infrared spectroscopy in agriculture</source>
      <publisher-name>American Society of Agronomy</publisher-name>
      <year iso-8601-date="2004">2004</year>
    </element-citation>
  </ref>
  <ref id="ref-garrido-varo_note_2019">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Garrido-Varo</surname><given-names>A</given-names></name>
        <name><surname>Garcia-Olmo</surname><given-names>J</given-names></name>
        <name><surname>Fearn</surname><given-names>T</given-names></name>
      </person-group>
      <article-title>A note on Mahalanobis and related distance measures in WinISI and The Unscrambler</article-title>
      <source>Journal of Near Infrared Spectroscopy</source>
      <year iso-8601-date="2019-08">2019</year><month>08</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-04-26">2023</year><month>04</month><day>26</day></date-in-citation>
      <volume>27</volume>
      <issue>4</issue>
      <issn>0967-0335</issn>
      <uri>https://doi.org/10.1177/0967033519848296</uri>
      <pub-id pub-id-type="doi">10.1177/0967033519848296</pub-id>
      <fpage>253</fpage>
      <lpage>258</lpage>
    </element-citation>
  </ref>
  <ref id="ref-williams_application_1975">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Williams</surname><given-names>P. C.</given-names></name>
      </person-group>
      <article-title>Application of near infrared reflectance spectroscopy to analysis of cereal grains and oilseeds</article-title>
      <source>Cereal chemistry</source>
      <year iso-8601-date="1975-07">1975</year><month>07</month>
      <volume>52</volume>
      <issue>4 p.561-576</issue>
      <issn>0009-0352</issn>
      <fpage>576</fpage>
      <lpage>561</lpage>
    </element-citation>
  </ref>
  <ref id="ref-barta_proteomic_2024">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Bárta</surname><given-names>Jan</given-names></name>
        <name><surname>Roudnický</surname><given-names>Pavel</given-names></name>
        <name><surname>Jarošová</surname><given-names>Markéta</given-names></name>
        <name><surname>Zdráhal</surname><given-names>Zbyněk</given-names></name>
        <name><surname>Stupková</surname><given-names>Adéla</given-names></name>
        <name><surname>Bártová</surname><given-names>Veronika</given-names></name>
        <name><surname>Krejčová</surname><given-names>Zlatuše</given-names></name>
        <name><surname>Kyselka</surname><given-names>Jan</given-names></name>
        <name><surname>Filip</surname><given-names>Vladimír</given-names></name>
        <name><surname>Říha</surname><given-names>Václav</given-names></name>
        <name><surname>Lorenc</surname><given-names>František</given-names></name>
        <name><surname>Bedrníček</surname><given-names>Jan</given-names></name>
        <name><surname>Smetana</surname><given-names>Pavel</given-names></name>
      </person-group>
      <article-title>Proteomic Profiles of Whole Seeds, Hulls, and Dehulled Seeds of Two Industrial Hemp (Cannabis sativa L.) Cultivars</article-title>
      <source>Plants</source>
      <year iso-8601-date="2024-01">2024</year><month>01</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-07">2024</year><month>03</month><day>07</day></date-in-citation>
      <volume>13</volume>
      <issue>1</issue>
      <issn>2223-7747</issn>
      <uri>https://www.mdpi.com/2223-7747/13/1/111</uri>
      <pub-id pub-id-type="doi">10.3390/plants13010111</pub-id>
      <fpage>111</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-geyer_genetics_2022">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Geyer</surname><given-names>Manuel</given-names></name>
        <name><surname>Mohler</surname><given-names>Volker</given-names></name>
        <name><surname>Hartl</surname><given-names>Lorenz</given-names></name>
      </person-group>
      <article-title>Genetics of the Inverse Relationship between Grain Yield and Grain Protein Content in Common Wheat</article-title>
      <source>Plants</source>
      <year iso-8601-date="2022-08">2022</year><month>08</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-07">2024</year><month>03</month><day>07</day></date-in-citation>
      <volume>11</volume>
      <issue>16</issue>
      <issn>2223-7747</issn>
      <uri>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9413592/</uri>
      <pub-id pub-id-type="doi">10.3390/plants11162146</pub-id>
      <pub-id pub-id-type="pmid">36015449</pub-id>
      <fpage>2146</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-giancaspro_genetic_2019">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Giancaspro</surname><given-names>Angelica</given-names></name>
        <name><surname>Giove</surname><given-names>Stefania L.</given-names></name>
        <name><surname>Blanco</surname><given-names>Antonio</given-names></name>
        <name><surname>Gadaleta</surname><given-names>Agata</given-names></name>
      </person-group>
      <article-title>Genetic Variation for Protein Content and Yield-Related Traits in a Durum Population Derived From an Inter-Specific Cross Between Hexaploid and Tetraploid Wheat Cultivars</article-title>
      <source>Frontiers in Plant Science</source>
      <year iso-8601-date="2019-11">2019</year><month>11</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-07">2024</year><month>03</month><day>07</day></date-in-citation>
      <volume>10</volume>
      <issn>1664-462X</issn>
      <uri>https://www.frontiersin.org/journals/plant-science/articles/10.3389/fpls.2019.01509/full</uri>
      <pub-id pub-id-type="doi">10.3389/fpls.2019.01509</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-ely_industrial_2022">
    <element-citation publication-type="chapter">
      <person-group person-group-type="author">
        <name><surname>Ely</surname><given-names>Kristine</given-names></name>
        <name><surname>Fike</surname><given-names>John</given-names></name>
      </person-group>
      <article-title>Industrial Hemp and Hemp Byproducts as Sustainable Feedstuffs in Livestock Diets</article-title>
      <source>Cannabis/Hemp for Sustainable Agriculture and Materials</source>
      <person-group person-group-type="editor">
        <name><surname>Agrawal</surname><given-names>Dinesh Chandra</given-names></name>
        <name><surname>Kumar</surname><given-names>Rajiv</given-names></name>
        <name><surname>Dhanasekaran</surname><given-names>Muralikrishnan</given-names></name>
      </person-group>
      <publisher-name>Springer</publisher-name>
      <publisher-loc>Singapore</publisher-loc>
      <year iso-8601-date="2022">2022</year>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-08">2024</year><month>03</month><day>08</day></date-in-citation>
      <isbn>9789811687785</isbn>
      <uri>https://doi.org/10.1007/978-981-16-8778-5_6</uri>
      <pub-id pub-id-type="doi">10.1007/978-981-16-8778-5_6</pub-id>
      <fpage>145</fpage>
      <lpage>162</lpage>
    </element-citation>
  </ref>
  <ref id="ref-hayes_measuring_2020">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hayes</surname><given-names>Maria</given-names></name>
      </person-group>
      <article-title>Measuring Protein Content in Food: An Overview of Methods</article-title>
      <source>Foods</source>
      <year iso-8601-date="2020-09">2020</year><month>09</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-08">2024</year><month>03</month><day>08</day></date-in-citation>
      <volume>9</volume>
      <issue>10</issue>
      <issn>2304-8158</issn>
      <uri>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7597951/</uri>
      <pub-id pub-id-type="doi">10.3390/foods9101340</pub-id>
      <pub-id pub-id-type="pmid">32977393</pub-id>
      <fpage>1340</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-bellon-maurel2010">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Bellon-Maurel</surname><given-names>Véronique</given-names></name>
        <name><surname>Fernandez-Ahumada</surname><given-names>Elvira</given-names></name>
        <name><surname>Palagos</surname><given-names>Bernard</given-names></name>
        <name><surname>Roger</surname><given-names>Jean-Michel</given-names></name>
        <name><surname>McBratney</surname><given-names>Alex</given-names></name>
      </person-group>
      <article-title>Critical review of chemometric indicators commonly used for assessing the quality of the prediction of soil attributes by NIR spectroscopy</article-title>
      <source>TrAC Trends in Analytical Chemistry</source>
      <year iso-8601-date="2010-10-01">2010</year><month>10</month><day>01</day>
      <volume>29</volume>
      <issue>9</issue>
      <uri>https://www.sciencedirect.com/science/article/pii/S0165993610001585</uri>
      <pub-id pub-id-type="doi">10.1016/j.trac.2010.05.006</pub-id>
      <fpage>1073</fpage>
      <lpage>1081</lpage>
    </element-citation>
  </ref>
  <ref id="ref-base">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <string-name>R Core Team</string-name>
      </person-group>
      <source>R: A language and environment for statistical computing</source>
      <publisher-name>R Foundation for Statistical Computing</publisher-name>
      <publisher-loc>Vienna, Austria</publisher-loc>
      <year iso-8601-date="2024">2024</year>
      <uri>https://www.R-project.org/</uri>
    </element-citation>
  </ref>
  <ref id="ref-caret">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <string-name>Kuhn</string-name>
        <string-name>Max</string-name>
      </person-group>
      <article-title>Building predictive models in r using the caret package</article-title>
      <source>Journal of Statistical Software</source>
      <year iso-8601-date="2008">2008</year>
      <volume>28</volume>
      <issue>5</issue>
      <uri>https://www.jstatsoft.org/index.php/jss/article/view/v028i05</uri>
      <pub-id pub-id-type="doi">10.18637/jss.v028.i05</pub-id>
      <fpage>1</fpage>
      <lpage>26</lpage>
    </element-citation>
  </ref>
  <ref id="ref-datatable">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Barrett</surname><given-names>Tyson</given-names></name>
        <name><surname>Dowle</surname><given-names>Matt</given-names></name>
        <name><surname>Srinivasan</surname><given-names>Arun</given-names></name>
        <name><surname>Gorecki</surname><given-names>Jan</given-names></name>
        <name><surname>Chirico</surname><given-names>Michael</given-names></name>
        <name><surname>Hocking</surname><given-names>Toby</given-names></name>
      </person-group>
      <source>data.table: Extension of ‘data.frame’</source>
      <year iso-8601-date="2024">2024</year>
      <uri>https://CRAN.R-project.org/package=data.table</uri>
    </element-citation>
  </ref>
  <ref id="ref-emmeans">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Lenth</surname><given-names>Russell V.</given-names></name>
      </person-group>
      <source>emmeans: Estimated marginal means, aka least-squares means</source>
      <year iso-8601-date="2024">2024</year>
      <uri>https://CRAN.R-project.org/package=emmeans</uri>
    </element-citation>
  </ref>
  <ref id="ref-knitr2023">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
      </person-group>
      <source>knitr: A general-purpose package for dynamic report generation in r</source>
      <year iso-8601-date="2023">2023</year>
      <uri>https://yihui.org/knitr/</uri>
    </element-citation>
  </ref>
  <ref id="ref-knitr2015">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
      </person-group>
      <source>Dynamic documents with R and knitr</source>
      <publisher-name>Chapman; Hall/CRC</publisher-name>
      <publisher-loc>Boca Raton, Florida</publisher-loc>
      <year iso-8601-date="2015">2015</year>
      <edition>2nd</edition>
      <uri>https://yihui.org/knitr/</uri>
    </element-citation>
  </ref>
  <ref id="ref-knitr2014">
    <element-citation publication-type="chapter">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
      </person-group>
      <article-title>knitr: A comprehensive tool for reproducible research in R</article-title>
      <source>Implementing reproducible computational research</source>
      <person-group person-group-type="editor">
        <name><surname>Stodden</surname><given-names>Victoria</given-names></name>
        <name><surname>Leisch</surname><given-names>Friedrich</given-names></name>
        <name><surname>Peng</surname><given-names>Roger D.</given-names></name>
      </person-group>
      <publisher-name>Chapman; Hall/CRC</publisher-name>
      <year iso-8601-date="2014">2014</year>
    </element-citation>
  </ref>
  <ref id="ref-lme4">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Bates</surname><given-names>Douglas</given-names></name>
        <name><surname>Mächler</surname><given-names>Martin</given-names></name>
        <name><surname>Bolker</surname><given-names>Ben</given-names></name>
        <name><surname>Walker</surname><given-names>Steve</given-names></name>
      </person-group>
      <article-title>Fitting linear mixed-effects models using lme4</article-title>
      <source>Journal of Statistical Software</source>
      <year iso-8601-date="2015">2015</year>
      <volume>67</volume>
      <issue>1</issue>
      <pub-id pub-id-type="doi">10.18637/jss.v067.i01</pub-id>
      <fpage>1</fpage>
      <lpage>48</lpage>
    </element-citation>
  </ref>
  <ref id="ref-multcomp">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hothorn</surname><given-names>Torsten</given-names></name>
        <name><surname>Bretz</surname><given-names>Frank</given-names></name>
        <name><surname>Westfall</surname><given-names>Peter</given-names></name>
      </person-group>
      <article-title>Simultaneous inference in general parametric models</article-title>
      <source>Biometrical Journal</source>
      <year iso-8601-date="2008">2008</year>
      <volume>50</volume>
      <issue>3</issue>
      <fpage>346</fpage>
      <lpage>363</lpage>
    </element-citation>
  </ref>
  <ref id="ref-nlme2023">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Pinheiro</surname><given-names>José</given-names></name>
        <name><surname>Bates</surname><given-names>Douglas</given-names></name>
        <string-name>R Core Team</string-name>
      </person-group>
      <source>nlme: Linear and nonlinear mixed effects models</source>
      <year iso-8601-date="2023">2023</year>
      <uri>https://CRAN.R-project.org/package=nlme</uri>
    </element-citation>
  </ref>
  <ref id="ref-nlme2000">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Pinheiro</surname><given-names>José C.</given-names></name>
        <name><surname>Bates</surname><given-names>Douglas M.</given-names></name>
      </person-group>
      <source>Mixed-effects models in s and s-PLUS</source>
      <publisher-name>Springer</publisher-name>
      <publisher-loc>New York</publisher-loc>
      <year iso-8601-date="2000">2000</year>
      <pub-id pub-id-type="doi">10.1007/b98882</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-pls">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Liland</surname><given-names>Kristian Hovde</given-names></name>
        <name><surname>Mevik</surname><given-names>Bjørn-Helge</given-names></name>
        <name><surname>Wehrens</surname><given-names>Ron</given-names></name>
      </person-group>
      <source>pls: Partial least squares and principal component regression</source>
      <year iso-8601-date="2023">2023</year>
      <uri>https://CRAN.R-project.org/package=pls</uri>
    </element-citation>
  </ref>
  <ref id="ref-prospectr">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Stevens</surname><given-names>Antoine</given-names></name>
        <name><surname>Ramirez-Lopez</surname><given-names>Leornardo</given-names></name>
      </person-group>
      <source>An introduction to the prospectr package</source>
      <year iso-8601-date="2024">2024</year>
    </element-citation>
  </ref>
  <ref id="ref-randomForest">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Liaw</surname><given-names>Andy</given-names></name>
        <name><surname>Wiener</surname><given-names>Matthew</given-names></name>
      </person-group>
      <article-title>Classification and regression by randomForest</article-title>
      <source>R News</source>
      <year iso-8601-date="2002">2002</year>
      <volume>2</volume>
      <issue>3</issue>
      <uri>https://CRAN.R-project.org/doc/Rnews/</uri>
      <fpage>18</fpage>
      <lpage>22</lpage>
    </element-citation>
  </ref>
  <ref id="ref-rmarkdown2024">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Allaire</surname><given-names>JJ</given-names></name>
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
        <name><surname>Dervieux</surname><given-names>Christophe</given-names></name>
        <name><surname>McPherson</surname><given-names>Jonathan</given-names></name>
        <name><surname>Luraschi</surname><given-names>Javier</given-names></name>
        <name><surname>Ushey</surname><given-names>Kevin</given-names></name>
        <name><surname>Atkins</surname><given-names>Aron</given-names></name>
        <name><surname>Wickham</surname><given-names>Hadley</given-names></name>
        <name><surname>Cheng</surname><given-names>Joe</given-names></name>
        <name><surname>Chang</surname><given-names>Winston</given-names></name>
        <name><surname>Iannone</surname><given-names>Richard</given-names></name>
      </person-group>
      <source>rmarkdown: Dynamic documents for r</source>
      <year iso-8601-date="2024">2024</year>
      <uri>https://github.com/rstudio/rmarkdown</uri>
    </element-citation>
  </ref>
  <ref id="ref-rmarkdown2018">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
        <name><surname>Allaire</surname><given-names>J. J.</given-names></name>
        <name><surname>Grolemund</surname><given-names>Garrett</given-names></name>
      </person-group>
      <source>R markdown: The definitive guide</source>
      <publisher-name>Chapman; Hall/CRC</publisher-name>
      <publisher-loc>Boca Raton, Florida</publisher-loc>
      <year iso-8601-date="2018">2018</year>
      <isbn>9781138359338</isbn>
      <uri>https://bookdown.org/yihui/rmarkdown</uri>
    </element-citation>
  </ref>
  <ref id="ref-rmarkdown2020">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
        <name><surname>Dervieux</surname><given-names>Christophe</given-names></name>
        <name><surname>Riederer</surname><given-names>Emily</given-names></name>
      </person-group>
      <source>R markdown cookbook</source>
      <publisher-name>Chapman; Hall/CRC</publisher-name>
      <publisher-loc>Boca Raton, Florida</publisher-loc>
      <year iso-8601-date="2020">2020</year>
      <isbn>9780367563837</isbn>
      <uri>https://bookdown.org/yihui/rmarkdown-cookbook</uri>
    </element-citation>
  </ref>
  <ref id="ref-skimr">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Waring</surname><given-names>Elin</given-names></name>
        <name><surname>Quinn</surname><given-names>Michael</given-names></name>
        <name><surname>McNamara</surname><given-names>Amelia</given-names></name>
        <name><surname>Arino de la Rubia</surname><given-names>Eduardo</given-names></name>
        <name><surname>Zhu</surname><given-names>Hao</given-names></name>
        <name><surname>Ellis</surname><given-names>Shannon</given-names></name>
      </person-group>
      <source>skimr: Compact and flexible summaries of data</source>
      <year iso-8601-date="2022">2022</year>
      <uri>https://CRAN.R-project.org/package=skimr</uri>
    </element-citation>
  </ref>
  <ref id="ref-tidymodels">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Kuhn</surname><given-names>Max</given-names></name>
        <name><surname>Wickham</surname><given-names>Hadley</given-names></name>
      </person-group>
      <source>Tidymodels: A collection of packages for modeling and machine learning using tidyverse principles.</source>
      <year iso-8601-date="2020">2020</year>
      <uri>https://www.tidymodels.org</uri>
    </element-citation>
  </ref>
  <ref id="ref-tidyverse">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Wickham</surname><given-names>Hadley</given-names></name>
        <name><surname>Averick</surname><given-names>Mara</given-names></name>
        <name><surname>Bryan</surname><given-names>Jennifer</given-names></name>
        <name><surname>Chang</surname><given-names>Winston</given-names></name>
        <name><surname>McGowan</surname><given-names>Lucy D’Agostino</given-names></name>
        <name><surname>François</surname><given-names>Romain</given-names></name>
        <name><surname>Grolemund</surname><given-names>Garrett</given-names></name>
        <name><surname>Hayes</surname><given-names>Alex</given-names></name>
        <name><surname>Henry</surname><given-names>Lionel</given-names></name>
        <name><surname>Hester</surname><given-names>Jim</given-names></name>
        <name><surname>Kuhn</surname><given-names>Max</given-names></name>
        <name><surname>Pedersen</surname><given-names>Thomas Lin</given-names></name>
        <name><surname>Miller</surname><given-names>Evan</given-names></name>
        <name><surname>Bache</surname><given-names>Stephan Milton</given-names></name>
        <name><surname>Müller</surname><given-names>Kirill</given-names></name>
        <name><surname>Ooms</surname><given-names>Jeroen</given-names></name>
        <name><surname>Robinson</surname><given-names>David</given-names></name>
        <name><surname>Seidel</surname><given-names>Dana Paige</given-names></name>
        <name><surname>Spinu</surname><given-names>Vitalie</given-names></name>
        <name><surname>Takahashi</surname><given-names>Kohske</given-names></name>
        <name><surname>Vaughan</surname><given-names>Davis</given-names></name>
        <name><surname>Wilke</surname><given-names>Claus</given-names></name>
        <name><surname>Woo</surname><given-names>Kara</given-names></name>
        <name><surname>Yutani</surname><given-names>Hiroaki</given-names></name>
      </person-group>
      <article-title>Welcome to the tidyverse</article-title>
      <source>Journal of Open Source Software</source>
      <year iso-8601-date="2019">2019</year>
      <volume>4</volume>
      <issue>43</issue>
      <pub-id pub-id-type="doi">10.21105/joss.01686</pub-id>
      <fpage>1686</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
</ref-list>
</back>

<sub-article article-type="notebook" id="nb-8-nb-article">
<front-stub>
<title-group>
<article-title>Near Infra-Red Spectroscopy Predicts Crude Protein in
Hemp Grain</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Crawford</surname>
<given-names>Ryan</given-names>
</name>
<string-name>Ryan Crawford</string-name>

<email>rvc3@cornell.edu</email>
<xref ref-type="aff" rid="aff-1-nb-article">a</xref>
<xref ref-type="corresp" rid="cor-1-nb-article">&#x002A;</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Crawford</surname>
<given-names>Jamie</given-names>
</name>
<string-name>Jamie Crawford</string-name>

<xref ref-type="aff" rid="aff-1-nb-article">a</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Smart</surname>
<given-names>Lawrence B.</given-names>
</name>
<string-name>Lawrence B. Smart</string-name>

<xref ref-type="aff" rid="aff-2-nb-article">b</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Moore</surname>
<given-names>Virginia</given-names>
</name>
<string-name>Virginia Moore</string-name>

<xref ref-type="aff" rid="aff-3-nb-article">c</xref>
</contrib>
</contrib-group>
<aff id="aff-1-nb-article">
<institution-wrap>
<institution>Cornell University</institution>
</institution-wrap>
<addr-line>126 Medicago Drive</addr-line>
<city>Ithaca</city>
<state>NY</state>

<postal-code>14853</postal-code>


</aff>
<aff id="aff-2-nb-article">
<institution-wrap>
<institution>Cornell AgriTech</institution>
</institution-wrap>
<addr-line>102 Hedrick Hall</addr-line>
<city>Geneva</city>
<state>NY</state>

<postal-code>14456</postal-code>


</aff>
<aff id="aff-3-nb-article">
<institution-wrap>
<institution>Cornell University</institution>
</institution-wrap>
<addr-line>162 Emerson Hall</addr-line>
<city>Ithaca</city>
<state>NY</state>

<postal-code>14853</postal-code>


</aff>
<author-notes>
<corresp id="cor-1-nb-article">rvc3@cornell.edu</corresp>
</author-notes>
<abstract>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
ex ea commodo consequat. Duis aute irure dolor in reprehenderit in
voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur
sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt
mollit anim id est laborum.</p>
</abstract>
</front-stub>

<body>
<sec id="nb-code-cell-1-nb-article" specific-use="notebook-code">
<code language="r script">library(tidyverse)</code>
<code language="r script">library(data.table)</code>
<code language="r script">library(caret)</code>
<code language="r script">library(prospectr)</code>
<code language="r script">library(pls)</code>
<code language="r script">library(tidymodels)</code>
<code language="r script">library(nlme)</code>
<sec id="nb-code-cell-1-output-0-nb-article" specific-use="notebook-output">
<preformat>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</preformat>
</sec>
<sec id="nb-code-cell-1-output-1-nb-article" specific-use="notebook-output">
<preformat>
Attaching package: 'data.table'

The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year

The following objects are masked from 'package:dplyr':

    between, first, last

The following object is masked from 'package:purrr':

    transpose</preformat>
</sec>
<sec id="nb-code-cell-1-output-2-nb-article" specific-use="notebook-output">
<preformat>Loading required package: lattice

Attaching package: 'caret'

The following object is masked from 'package:purrr':

    lift</preformat>
</sec>
<sec id="nb-code-cell-1-output-3-nb-article" specific-use="notebook-output">
<preformat>[34mprospectr version 0.2.7 -- cakes[39m
[34mcheck the package repository at: https://github.com/l-ramirez-lopez/prospectr[39m</preformat>
</sec>
<sec id="nb-code-cell-1-output-4-nb-article" specific-use="notebook-output">
<preformat>
Attaching package: 'pls'

The following object is masked from 'package:prospectr':

    msc

The following object is masked from 'package:caret':

    R2

The following object is masked from 'package:stats':

    loadings</preformat>
</sec>
<sec id="nb-code-cell-1-output-5-nb-article" specific-use="notebook-output">
<preformat>── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──
✔ broom        1.0.5      ✔ rsample      1.2.0 
✔ dials        1.2.1      ✔ tune         1.1.2 
✔ infer        1.0.6      ✔ workflows    1.1.4 
✔ modeldata    1.3.0      ✔ workflowsets 1.0.1 
✔ parsnip      1.2.0      ✔ yardstick    1.3.0 
✔ recipes      1.0.10     
── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ data.table::between()    masks dplyr::between()
✖ scales::discard()        masks purrr::discard()
✖ dplyr::filter()          masks stats::filter()
✖ data.table::first()      masks dplyr::first()
✖ recipes::fixed()         masks stringr::fixed()
✖ dplyr::lag()             masks stats::lag()
✖ data.table::last()       masks dplyr::last()
✖ caret::lift()            masks purrr::lift()
✖ yardstick::precision()   masks caret::precision()
✖ yardstick::recall()      masks caret::recall()
✖ yardstick::sensitivity() masks caret::sensitivity()
✖ yardstick::spec()        masks readr::spec()
✖ yardstick::specificity() masks caret::specificity()
✖ recipes::step()          masks stats::step()
✖ data.table::transpose()  masks purrr::transpose()
• Learn how to get started at https://www.tidymodels.org/start/</preformat>
</sec>
<sec id="nb-code-cell-1-output-6-nb-article" specific-use="notebook-output">
<preformat>
Attaching package: 'nlme'

The following object is masked from 'package:dplyr':

    collapse</preformat>
</sec>
</sec>
<p><bold>incomplete: may contain errors, run-ons, half-thoughts,
etc.</bold></p>
<sec id="introduction-nb-article">
  <title>INTRODUCTION</title>
  <p>Hemp (Cannabis sativa L.) is an annual crop with potential uses as
  a source of food or feed from grain, and bast fiber or hurd from the
  stalk. Hemp cultivars are commonly grown for one or both purposes and
  a cultivar may be referred to as a grain, fiber, or dual-purpose type.
  Because of protein’s nutritional importance, the protein content of a
  grain crop is an prime consideration for researchers, producers, and
  consumers. Whole hemp grain typically contains approximately 20-30%
  protein
  (<xref alt="Ely and Fike 2022" rid="ref-ely_industrial_2022-nb-article" ref-type="bibr">Ely
  and Fike 2022</xref>;
  <xref alt="Bárta et al. 2024" rid="ref-barta_proteomic_2024-nb-article" ref-type="bibr">Bárta
  et al. 2024</xref>;
  <xref alt="callaway2004?" rid="ref-callaway2004-nb-article" ref-type="bibr"><bold>callaway2004?</bold></xref>).
  Crude protein (CP) is often used as a proxy for the direct measurement
  of protein concentration and consists of the multiplication of
  nitrogen concentration by a conversion factor because measuring
  nitrogen concentration is relatively easy and cheap via laboratory
  assay
  (<xref alt="Hayes 2020" rid="ref-hayes_measuring_2020-nb-article" ref-type="bibr">Hayes
  2020</xref>).</p>
  <p>Near-infrared spectroscopy (NIRS) technology is rapid,
  non-destructive, and cheap, and consists of the measurement of NIR
  radiation reflected from a sample
  (<xref alt="Roberts, Workman, and Reeves 2004" rid="ref-roberts_near-infrared_2004-nb-article" ref-type="bibr">Roberts,
  Workman, and Reeves 2004</xref>). NIR spectra from many samples are
  related to laboratory values for components such as moisture, protein,
  fat, or fiber
  (<xref alt="Roberts, Workman, and Reeves 2004" rid="ref-roberts_near-infrared_2004-nb-article" ref-type="bibr">Roberts,
  Workman, and Reeves 2004</xref>). NIRS technology has been used since
  the 1970’s to assess forage CP
  (<xref alt="Reeves 2012" rid="ref-reeves_potential_2012-nb-article" ref-type="bibr">Reeves
  2012</xref>;
  <xref alt="Williams 1975" rid="ref-williams_application_1975-nb-article" ref-type="bibr">Williams
  1975</xref>). A NIRS calibration set often consists of samples from
  one species grown in many environments encompassing the range of
  expected values from the analyte or analytes
  (<xref alt="Chadalavada et al. 2022" rid="ref-chadalavada_nir_2022-nb-article" ref-type="bibr">Chadalavada
  et al. 2022</xref>). Partial least squares regression (PLSR) is a
  typical method used in the agricultural and food sciences to relate
  spectra to analyte
  (<xref alt="Roberts, Workman, and Reeves 2004" rid="ref-roberts_near-infrared_2004-nb-article" ref-type="bibr">Roberts,
  Workman, and Reeves 2004</xref>). PLSR calculates principal components
  (PCs) which relate to the dependent variable and summarize the spectra
  and uses a subset of PCs in order to fit the regression model. PLSR is
  commonly used in spectroscopy because it tends to work well with
  highly-correlated spectral data. Typically the number of principal
  components is chosen via cross-validation to avoid overfitting.
  <bold>CITES FOR ALL OF THIS</bold></p>
  <p>A NIRS-scanned sample of undamaged grain may subsequently be grown,
  an important consideration for a plant breeder. In wheat and corn,
  grain protein content has been shown to be heritable
  (<xref alt="Giancaspro et al. 2019" rid="ref-giancaspro_genetic_2019-nb-article" ref-type="bibr">Giancaspro
  et al. 2019</xref>;
  <xref alt="Geyer, Mohler, and Hartl 2022" rid="ref-geyer_genetics_2022-nb-article" ref-type="bibr">Geyer,
  Mohler, and Hartl 2022</xref>). This suggests (at least potentially)
  that NIRS technology could serve as resource to more rapidly identify
  high CP hemp germplasm, enabling the delivery of higher CP hemp grain
  cultivars faster.</p>
  <p>For this study, a benchtop NIR spectrometer was used to develop a
  model to predict CP content based on a data set of hemp grain
  representing multiple years, locations, and cultivars from grain and
  dual-purpose hemp types using PLSR.</p>
</sec>
<sec id="materials-and-methods-nb-article">
  <title>MATERIALS AND METHODS</title>
  <sec id="nb-code-cell-2-nb-article" specific-use="notebook-code">
  <code language="r script"># bckgrnd &lt;- fread(&quot;./input_data/simplified_data/background_data_set.csv&quot;) |&gt; setDT()

# spectra &lt;- fread(&quot;./input_data/simplified_data/train_test_crude_protein.csv&quot;)

 # bckgrnd[,in_ny:= ifelse(loc!=&quot;kentucky&quot;, T, F)]
 
# bg2 &lt;- bckgrnd[loc!=&quot;kentucky&quot;]

# extract indices of non-kentucky
# bg_indices &lt;- bckgrnd[loc!=&quot;kentucky&quot;, which = T]

# correct names in bg2--should be h-51, NOT hl-51

# bg2[cultivar==&quot;hl-51&quot;]$cultivar &lt;- &quot;h-51&quot;

# check to see if i did the calc correctly

# bg2[grepl(&quot;51&quot;, cultivar),]

 #looks good 
# tab &lt;-  table(bckgrnd$in_ny)


# now take correct spectra filtering out stuff from KY

# spectra_2 &lt;- spectra[bg_indices]</code>
  </sec>
  <sec id="nb-code-cell-3-nb-article" specific-use="notebook-code">
  <code language="r script"># should be correct finalized data sets, 

# notably, switches sample 2 and 7 around

full_data &lt;- fread(&quot;./input_data/final_data_set/full_hemp_data.csv&quot;)

tab &lt;-  table(full_data$in_ny)</code>
  </sec>
  <sec id="hemp-grain-sample-background-nb-article">
    <title>Hemp Grain Sample Background</title>
    <p>Spectral data were obtained from whole (unground) hemp grain
    samples, harvested at maturity, collected from 2017 - 2021 from 18
    cultivar trials in New York (NY) (NA samples). Grain samples were
    obtained by hand sampling or mechanical harvest and were cleaned of
    chaff and dried at 30 C for six days in a forced-air dryer. In
    total, 38 cultivars were represented in the data set. Cultivars were
    grain or dual-purpose types and included both commercially available
    and experimental material.</p>
    <p>All cultivar trials were planted in randomized complete block
    design with each cultivar replicated four times. The 2017 data were
    comprised of samples from the same thirteen cultivars sampled from
    six NY locations. For those trials, grain was harvested from each
    plot individually and aggregated by cultivar within each trial. Four
    subsamples were drawn from each aggregated sample and scanned
    separately. These spectra were averaged at each 2 nm increment. All
    remaining samples from 2018-2021 were collected on a per-plot basis.
    All possible cultivars and possible locations were represented in
    2017, but only a selected subset of cultivars and locations were
    represented in 2018-2021.</p>
  </sec>
  <sec id="spectral-data-collection-and-preprocessing-nb-article">
    <title>Spectral Data Collection and Preprocessing</title>
    <p>A benchtop NIR spectrometer (FOSS/ NIR FOSS/ NIR Systems model
    5000) was used to obtain the spectra (FOSS North America, Eden
    Prairie, MN, USA). Spectra were collected every 2 nm from 1100-2498
    nm and the logarithm of reciprocal reflectance was recorded.</p>
    <p>WINISI software version 1.02A (Infrasoft International, Port
    Matilda, PA, USA) was used to average the spectra in 2017, as well
    as to select samples for laboratory assay. Samples were selected
    according to their spectral distance from their nearest neighbor
    within the calibration data set with a cutoff of a distance of 0.6
    H, where H is approximately equal to the squared Mahalanobis
    distance divided by the number of principal components used in the
    calculation
    (<xref alt="Garrido-Varo, Garcia-Olmo, and Fearn 2019" rid="ref-garrido-varo_note_2019-nb-article" ref-type="bibr">Garrido-Varo,
    Garcia-Olmo, and Fearn 2019</xref>). Prior to selection selection,
    spectra were preprocessed using SNV-detrend with settings 1,4,4,1
    for the derivative, gap, smooth, and smooth 2 settings
    respectively.</p>
  </sec>
  <sec id="laboratory-validation-nb-article">
    <title>Laboratory Validation</title>
    <p>Laboratory assays were performed by Dairy One Forage Laboratory
    (Ithaca, NY). For those assays, 1mm ground samples were analyzed by
    combustion using a CN628 or CN928 Carbon/Nitrogen Determinator.
    Samples from 2017 were aggregated as described above, but the
    remaining samples were not aggregated.</p>
  </sec>
  <sec id="model-development-nb-article">
    <title>Model Development</title>
    <p>Calibration and validations sets were created by dividing the
    laboratory CP values into tertiles according to their percent CP in
    order to ensure that the range of CP values was present in both
    calibration and validation sets. Within each tertile, 75% of the
    samples were randomly assigned to the calibration set and the
    remaining 25% were assigned to the validation set. For each
    calibration set, models were developed in caret using PLSR. In
    fitting the model, the number of principal components was optimized
    over au grid search from 1-20. Model performance was evaluated with
    25 iterations of bootstrapping and minimized root mean squared error
    (RMSE) in selecting the number of principal components in the final
    model
    (<xref alt="kuhn2008?" rid="ref-kuhn2008-nb-article" ref-type="bibr"><bold>kuhn2008?</bold></xref>).</p>
    <sec id="nb-code-cell-4-nb-article" specific-use="notebook-code">
    <code language="r script">preproc_key &lt;- fread(&quot;./input_data/final_data_set/preprocessing_key.csv&quot;)

preproc_key[,full_name:= c(&quot;Raw Spectra&quot;, &quot;First Derivative&quot;, &quot;Second Derivative&quot;,&quot;Savitzky-Golay&quot;, &quot;Gap-segment Derivative&quot;,
                           &quot;Standard Normal Variate&quot;, &quot;Standard Normal Variate following Savitzky-Golay&quot;, &quot;Standard Normal Variate-Detrend&quot;, &quot;Multiplicative Scatter Correction&quot;)]</code>
    </sec>
    <p>Initially a number of common spectral preprocessing methods were
    tested by creating 100 calibration and validation sets as described
    above. Spectral data from those data sets were transformed by each
    of the following methods: 1) first derivative, 2) Savitzky-Golay
    (SG), 3) gap-segment derivative, 4) standard normal variate (SNV),
    4) standard normal variate following Savitzky-Golay (SNV-SG), 5)
    SNV-detrend, and 6) multiplicative scatter correction. For each of
    these preprocessing methods, models were fit and predictions were
    made on the corresponding validation set (since there were 8
    preprocessing methods, 8 separate models were fit for each of the
    100 sets. The relationship between the predicted and actual values
    of the validation set were calculated via RMSE, R<sup>2</sup> and
    Ratio of Performance to InterQuartile distance (RPIQ), three common
    model assessment metrics. Analyses of variance (ANOVA) were
    performed for each of these metrics in order to compare the
    preprocessing methods. For each ANOVA, each data set was considered
    as a subject and allowing different variances for each preprocessing
    method.</p>
    <p>Once the most promising preprocessing method was identified, 1000
    more data sets were created and analyzed via that method and
    performance on the validation sets was summarized with RMSE,
    R<sup>2</sup>, and RPIQ.</p>
  </sec>
  <sec id="additional-software-used-nb-article">
    <title>Additional software used</title>
    <sec id="nb-code-cell-5-nb-article" specific-use="notebook-code">
    <code language="r script">grateful::cite_packages(output = &quot;paragraph&quot;, out.dir = &quot;.&quot;)</code>
    <p>We used R version 4.3.3
    (<xref alt="R Core Team 2024" rid="ref-base-nb-article" ref-type="bibr">R Core
    Team 2024</xref>) and the following R packages: caret v. 6.0.94
    (<xref alt="Kuhn and Max 2008" rid="ref-caret-nb-article" ref-type="bibr">Kuhn
    and Max 2008</xref>), data.table v. 1.15.2
    (<xref alt="Barrett et al. 2024" rid="ref-datatable-nb-article" ref-type="bibr">Barrett
    et al. 2024</xref>), emmeans v. 1.10.0
    (<xref alt="Lenth 2024" rid="ref-emmeans-nb-article" ref-type="bibr">Lenth
    2024</xref>), knitr v. 1.45
    (<xref alt="Xie 2014" rid="ref-knitr2014-nb-article" ref-type="bibr">Xie
    2014</xref>,
    <xref alt="2015" rid="ref-knitr2015-nb-article" ref-type="bibr">2015</xref>,
    <xref alt="2023" rid="ref-knitr2023-nb-article" ref-type="bibr">2023</xref>),
    lme4 v. 1.1.35.1
    (<xref alt="Bates et al. 2015" rid="ref-lme4-nb-article" ref-type="bibr">Bates
    et al. 2015</xref>), multcomp v. 1.4.25
    (<xref alt="Hothorn, Bretz, and Westfall 2008" rid="ref-multcomp-nb-article" ref-type="bibr">Hothorn,
    Bretz, and Westfall 2008</xref>), nlme v. 3.1.163
    (<xref alt="J. C. Pinheiro and Bates 2000" rid="ref-nlme2000-nb-article" ref-type="bibr">J.
    C. Pinheiro and Bates 2000</xref>;
    <xref alt="J. Pinheiro, Bates, and R Core Team 2023" rid="ref-nlme2023-nb-article" ref-type="bibr">J.
    Pinheiro, Bates, and R Core Team 2023</xref>), pls v. 2.8.3
    (<xref alt="Liland, Mevik, and Wehrens 2023" rid="ref-pls-nb-article" ref-type="bibr">Liland,
    Mevik, and Wehrens 2023</xref>), prospectr v. 0.2.7
    (<xref alt="Stevens and Ramirez-Lopez 2024" rid="ref-prospectr-nb-article" ref-type="bibr">Stevens
    and Ramirez-Lopez 2024</xref>), randomForest v. 4.7.1.1
    (<xref alt="Liaw and Wiener 2002" rid="ref-randomForest-nb-article" ref-type="bibr">Liaw
    and Wiener 2002</xref>), rmarkdown v. 2.26
    (<xref alt="Xie, Allaire, and Grolemund 2018" rid="ref-rmarkdown2018-nb-article" ref-type="bibr">Xie,
    Allaire, and Grolemund 2018</xref>;
    <xref alt="Xie, Dervieux, and Riederer 2020" rid="ref-rmarkdown2020-nb-article" ref-type="bibr">Xie,
    Dervieux, and Riederer 2020</xref>;
    <xref alt="Allaire et al. 2024" rid="ref-rmarkdown2024-nb-article" ref-type="bibr">Allaire
    et al. 2024</xref>), skimr v. 2.1.5
    (<xref alt="Waring et al. 2022" rid="ref-skimr-nb-article" ref-type="bibr">Waring
    et al. 2022</xref>), tidymodels v. 1.1.1
    (<xref alt="Kuhn and Wickham 2020" rid="ref-tidymodels-nb-article" ref-type="bibr">Kuhn
    and Wickham 2020</xref>), tidyverse v. 2.0.0
    (<xref alt="Wickham et al. 2019" rid="ref-tidyverse-nb-article" ref-type="bibr">Wickham
    et al. 2019</xref>).</p>
    </sec>
  </sec>
</sec>
<sec id="results-and-discussion-nb-article">
  <title>RESULTS AND DISCUSSION</title>
  <sec id="laboratory-assay-cp-values-nb-article">
    <title>Laboratory assay CP values</title>
    <p>Laboratory assay percent CP values are summarized in the
    following table. These are similar to the range of CP values
    observed in the literature, indicating an appropriate basis for a
    chemometric model. The CP values are left-skewed and two thirds of
    the samples contained more than 25% CP.</p>
    <sec id="nb-code-cell-6-nb-article" specific-use="notebook-code">
    <code language="r script">my_summary &lt;- full_data$crude_protein |&gt; skimr::skim()|&gt; select(c(5:11)) |&gt; 
  mutate_all(round, 1)
names(my_summary) &lt;- c(&quot;mean&quot;, &quot;sd&quot;, &quot;minimum&quot;, &quot;first quartile&quot;, &quot;median&quot;, &quot;third quartile&quot;, &quot;maximum&quot;) |&gt; str_to_title()

knitr::kable(my_summary)</code>
    <fig id="tbl-lab-protein-vals-nb-article">
      <caption><p>Table 1: Summary of Laboratory Assayed CP Values
      (Percent Dry Matter)</p></caption>
      <table-wrap>
        <table>
          <thead>
            <tr>
              <th align="right">Mean</th>
              <th align="right">Sd</th>
              <th align="right">Minimum</th>
              <th align="right">First Quartile</th>
              <th align="right">Median</th>
              <th align="right">Third Quartile</th>
              <th align="right">Maximum</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="right">26.1</td>
              <td align="right">2.5</td>
              <td align="right">20.8</td>
              <td align="right">23.9</td>
              <td align="right">26.4</td>
              <td align="right">28.2</td>
              <td align="right">30.8</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </fig>
    </sec>
  </sec>
  <sec id="preprocessing-methods-comparison-nb-article">
    <title>Preprocessing methods comparison</title>
    <sec id="nb-code-cell-7-nb-article" specific-use="notebook-code">
    <code language="r script"># 
multi_metric &lt;- metric_set(rmse, rsq, rpiq)


# read data back in to work with it

prep_key &lt;- fread(&quot;./input_data/final_data_set/preprocessing_key.csv&quot;)

sims_key &lt;- fread(&quot;./input_data/final_data_set/preprocessing_methods_test.csv&quot;)

long_form &lt;- merge(sims_key, prep_key, all.x = T)

# now pull the metrics

# long_form[, multi_metric(y, value), by = c(&quot;id&quot;, &quot;preproc&quot;)]

summaries &lt;- long_form |&gt; 
  filter(preproc!=&quot;second_derivative&quot;) |&gt; 
  group_by(id, preproc) |&gt; 
  multi_metric(y, value)

# # comparing methods over a series of metrics...
# summaries_with_models &lt;- summaries |&gt; 
#   mutate(id = as.character(id)) |&gt; 
#   nest(data = -.metric) |&gt; 
#   mutate(mod = map(data, ~lme4::lmer(.estimate ~ preproc + (1|id), data = .x)),
#          ems = map(mod, ~emmeans::emmeans(.x, &quot;preproc&quot;) |&gt; data.frame())
#          )
# 
# summaries_with_models_2 &lt;- summaries_with_models |&gt; 
#   select(1, ems) |&gt; 
#   unnest(ems)</code>
    </sec>
    <sec id="nb-code-cell-8-nb-article" specific-use="notebook-code">
    <code language="r script"># actually, let's summarize via nlme
# set our varident
vf2 &lt;- varIdent(form= ~ 1|preproc)

# define custom contrasts
first_part &lt;- rep(1/7,7)
contrast_full &lt;- append(first_part, -1, after = 3)


custom &lt;- list(preprocess_vs_raw = contrast_full)

nlme_summaries &lt;- summaries |&gt; 
  mutate(id = as.character(id)) |&gt; 
  nest(data = -.metric) |&gt; 
  mutate(
    mod_standard = map(data, ~nlme::lme(.estimate ~ preproc, random = ~1|id, data = .x, method =&quot;ML&quot;)),
    
    mod_varident = map(data, ~nlme::lme(.estimate ~ preproc, random = ~1|id, weights = vf2, data = .x, method =&quot;ML&quot;)),
    mod_compare = map2(mod_standard, mod_varident, ~anova(.x, .y)),
         ems = map(mod_varident, ~emmeans::emmeans(.x, &quot;preproc&quot;) |&gt;multcomp::cld() |&gt;  data.frame()), 
             ems2 = map(mod_varident, ~emmeans::emmeans(.x, &quot;preproc&quot;)),
                        contrast = map(ems2, ~emmeans::contrast(.x, custom))
                                       )



nlme_summaries_with_models_2 &lt;- nlme_summaries |&gt; 
  select(1, ems) |&gt; 
  unnest(ems)</code>
    </sec>
    <sec id="nb-code-cell-9-nb-article" specific-use="notebook-code">
    <code language="r script"># add full names

to_table &lt;- nlme_summaries_with_models_2|&gt; 
  left_join(preproc_key) |&gt; 
  select('Preprocessing Method' = full_name, Metric = .metric, Estimate = emmean, SE) |&gt; 
  mutate(Estimate = paste(format(round(Estimate, 2), nsmall = 2), &quot;±&quot;, format(round(SE, 3), nsmall = 3)))</code>
    <sec id="nb-code-cell-9-output-0-nb-article" specific-use="notebook-output">
    <preformat>Joining with `by = join_by(preproc)`</preformat>
    </sec>
    </sec>
    <sec id="nb-code-cell-10-nb-article" specific-use="notebook-code">
    <code language="r script">contrasts &lt;- nlme_summaries |&gt; 
  select(.metric, contrast) |&gt; 
  transmute(.metric, tidy_contrast = map(contrast, tidy)) |&gt; 
  unnest(tidy_contrast)</code>
    </sec>
    <sec id="nb-code-cell-11-nb-article" specific-use="notebook-code">
    <code language="r script"># lead_lag summaries
lead_lag &lt;- nlme_summaries_with_models_2 |&gt; select(1:4) |&gt; 
  arrange(.metric, emmean)%&gt;% 
  group_by(.metric) |&gt; 
  mutate(lagged = lag(emmean)) %&gt;% 
  mutate(pct_change = (emmean - lagged) / lagged)|&gt; 
  mutate(lead = lead(emmean)) %&gt;% 
  mutate(pct_change_lead = (emmean - lead) / lead)</code>
    </sec>
    <sec id="nb-code-cell-12-nb-article" specific-use="notebook-code">
    <code language="r script"># percent change for contrasts

raw_contrast &lt;- nlme_summaries_with_models_2 |&gt; filter(preproc==&quot;raw&quot;) |&gt; 
  dplyr::select(1:3) |&gt; 
  left_join(contrasts |&gt; select(1,3,estimated_diff = 5)) |&gt; 
  mutate(percent_difference = estimated_diff/(emmean+estimated_diff))</code>
    <sec id="nb-code-cell-12-output-0-nb-article" specific-use="notebook-output">
    <preformat>Joining with `by = join_by(.metric)`</preformat>
    </sec>
    </sec>
    <p>All preprocessing methods outperformed raw spectral data
    <xref alt="Table 2" rid="tbl-preproc-nb-article">Table 2</xref>. Averaged
    together, all preprocessed spectra were superior to raw spectra,
    with lower RMSE, and higher R<sup>2</sup> and RPIQ values
    (significant at <inline-formula><alternatives>
    <tex-math><![CDATA[\alpha]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>α</mml:mi></mml:math></alternatives></inline-formula>
    level &lt;0.001). Preprocessing methods had -11.6 % lower RMSE, and
    had 3.1% higher R<sup>2</sup> 7.4% higher RPIQ than unprocessed
    spectra.</p>
    <p>The SNV-SG method had the lowest RMSE, highest R<sup>2</sup>, and
    highest RPIQ averaging over all iterations. SNV-SG RMSE averaged
    1.4% lower, while R<sup>2</sup> and RPIQ averaged 0.4% and 2.4%
    higher respectively than the next best preprocessing method (SG in
    both cases), but the difference between the best and second best
    method by metric were only statistically significant at
    <inline-formula><alternatives>
    <tex-math><![CDATA[\alpha]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>α</mml:mi></mml:math></alternatives></inline-formula>
    &lt;0.05 for RPIQ. RPIQ was devised to accurately reflect the spread
    of data in skewed populations
    (<xref alt="Bellon-Maurel et al. 2010" rid="ref-bellon-maurel2010-nb-article" ref-type="bibr">Bellon-Maurel
    et al. 2010</xref>) and thus offers a robust metric for model
    assessment. Therefore the superiority of SNV-SG as measured via RPIQ
    made it the superior candidate for the choice of final model.</p>
    <sec id="nb-code-cell-13-nb-article" specific-use="notebook-code">
    <code language="r script"># printable table of results

to_table2 &lt;- to_table |&gt; 
  select(1:3) |&gt; 
  pivot_wider(names_from = Metric, values_from = Estimate) |&gt; 
  arrange(rmse) |&gt; 
  rename(RMSE = rmse, RPIQ = rpiq ) 
# names(to_table2)[3] &lt;- &quot;$^{2}<!-- (F2ED4C6E)[nb-article]:/home/runner/work/glowing-system/glowing-system/index.qmd -->quot;
to_table2|&gt; 
  knitr::kable(col.names = c(&quot;Preprocessing Method&quot;, &quot;RMSE&quot;, &quot;$R^{2}<!-- (F2ED4C6E)[nb-article]:/home/runner/work/glowing-system/glowing-system/index.qmd -->quot;, &quot;RPIQ&quot;))</code>
    <fig id="tbl-preproc-nb-article">
      <caption><p>Table 2: Evaluation of Preprocessing Methods by
      Metric</p></caption>
      <table-wrap>
        <table>
          <colgroup>
            <col width="56%" />
            <col width="15%" />
            <col width="15%" />
            <col width="15%" />
          </colgroup>
          <thead>
            <tr>
              <th align="left">Preprocessing Method</th>
              <th align="left">RMSE</th>
              <th align="left"><inline-formula><alternatives>
              <tex-math><![CDATA[R^{2}]]></tex-math>
              <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math></alternatives></inline-formula></th>
              <th align="left">RPIQ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">Standard Normal Variate following
              Savitzky-Golay</td>
              <td align="left">1.02 ± 0.012</td>
              <td align="left">0.84 ± 0.004</td>
              <td align="left">3.97 ± 0.076</td>
            </tr>
            <tr>
              <td align="left">Savitzky-Golay</td>
              <td align="left">1.03 ± 0.012</td>
              <td align="left">0.83 ± 0.004</td>
              <td align="left">3.88 ± 0.072</td>
            </tr>
            <tr>
              <td align="left">First Derivative</td>
              <td align="left">1.07 ± 0.013</td>
              <td align="left">0.82 ± 0.004</td>
              <td align="left">3.77 ± 0.075</td>
            </tr>
            <tr>
              <td align="left">Standard Normal Variate</td>
              <td align="left">1.12 ± 0.016</td>
              <td align="left">0.80 ± 0.005</td>
              <td align="left">3.61 ± 0.081</td>
            </tr>
            <tr>
              <td align="left">Gap-segment Derivative</td>
              <td align="left">1.12 ± 0.018</td>
              <td align="left">0.81 ± 0.006</td>
              <td align="left">3.60 ± 0.086</td>
            </tr>
            <tr>
              <td align="left">Standard Normal Variate-Detrend</td>
              <td align="left">1.13 ± 0.015</td>
              <td align="left">0.80 ± 0.005</td>
              <td align="left">3.55 ± 0.079</td>
            </tr>
            <tr>
              <td align="left">Multiplicative Scatter Correction</td>
              <td align="left">1.17 ± 0.016</td>
              <td align="left">0.79 ± 0.006</td>
              <td align="left">3.47 ± 0.080</td>
            </tr>
            <tr>
              <td align="left">Raw Spectra</td>
              <td align="left">1.22 ± 0.044</td>
              <td align="left">0.79 ± 0.009</td>
              <td align="left">3.42 ± 0.105</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </fig>
    </sec>
    <p><bold>paragraph discussing relative merits of various
    preprocessing methods</bold></p>
    <p>The preprocessing methods examined represent a portion of those
    available. As well, preprocessing methods tend to have a number of
    user-adjustable parameters whose various permutations were not
    tested. This subset of preprocessing methods and parameters
    nonetheless contained substantial variations in model quality,
    demonstrating the importance of the selection an appropriate
    preprocessing method.</p>
  </sec>
  <sec id="final-model-development-and-summary-nb-article">
    <title>Final model development and summary</title>
    <sec id="nb-code-cell-14-nb-article" specific-use="notebook-code">
    <code language="r script">model_n_comp_statistics &lt;- fread(&quot;./input_data/final_data_set/final_model_n_component_stats.csv&quot;)

# define a function to calculate percent difference
pct_lower &lt;- function(x){
  my_lag = data.table::shift(x, type = &quot;lag&quot;)
  round((x - my_lag)/my_lag*100,2)
}

avg_change &lt;- model_n_comp_statistics[,lapply(.SD, mean),.SDcols = 3:8, by= ncomp]

change_per_pc &lt;- avg_change[, lapply(.SD, pct_lower), .SDcols = 2:7]</code>
    </sec>
    <p>The model improved most rapidly as the number of principal
    components increased from 1 to 7, with the inclusion of each
    additional PC being associated with a decrease in RMSE of 5-12% .
    From 8 to 12 PCs, model performance continued to improve, although
    gains were more modest (decrease in RMSE of 0.7-3%). With 13 or more
    PCs, performance gains were minimal and the relative ranks of the
    models tended to be stable
    <xref alt="Figure 1" rid="fig-model-calibration-nb-article">Figure 1</xref>.</p>
    <sec id="cell-fig-model-calibration-nb-article" specific-use="notebook-code">
    <code language="r script">model_n_comp_statistics |&gt; 
  ggplot(aes(as.factor(ncomp), RMSE)) + 
  geom_line(aes(group = id), alpha = 0.03) + 
  theme_classic() + 
  xlab(&quot;Crude Protein Model Number of Principal Components&quot;) + 
  ylab(&quot;Crude Protein Model Root Mean Squared Error&quot;)</code>
    <fig id="fig-model-calibration-nb-article">
      <caption><p>Figure 1: Decreasing RMSE with increasing number of
      PCs</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-model-calibration-1.png" />
    </fig>
    </sec>
    <sec id="cell-fig-final-metric-boxplot-nb-article" specific-use="notebook-code">
    <code language="r script">model_final_predictions &lt;- fread(&quot;./input_data/final_data_set/final_model_predictions.csv&quot;)

# setnames(model_final_predictions, &quot;V1&quot;, &quot;crude_protein&quot;)


final_model_table &lt;- model_final_predictions |&gt; 
  group_by(id) |&gt; 
  multi_metric(crude_protein, predicted_crude_protein)

final_model_table |&gt;
  mutate(metric2 = toupper(.metric)) |&gt; 
  ggplot(aes(x = .metric, y = .estimate)) + 
  theme_classic() + geom_boxplot() + 
  facet_wrap(vars(metric2), scales = &quot;free&quot;) +
  xlab(&quot;Metric&quot;) + ylab(&quot;Estimate&quot;)+
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank())</code>
    <fig id="fig-final-metric-boxplot-nb-article">
      <caption><p>Figure 2: Final model validation set performance (1000
      iterations)</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-final-metric-boxplot-1.png" />
    </fig>
    </sec>
    <sec id="nb-code-cell-15-nb-article" specific-use="notebook-code">
    <code language="r script"># add difference calculation between predicted and observed...
model_final_predictions[,difference := predicted_crude_protein - crude_protein]</code>
    </sec>
    <sec id="nb-code-cell-16-nb-article" specific-use="notebook-code">
    <code language="r script"># my_cut &lt;- cut(spectra_2$crude_protein, 3)
# cut_dt &lt;- data.table(ith_in_data_set = 1:149, cutpoints = my_cut)


# revised_model_cutpoints
cutpoints2 &lt;- model_final_predictions |&gt; 
  distinct(ith_in_data_set, crude_protein) |&gt; 
  mutate(cutpoints = cut(crude_protein, 3))</code>
    </sec>
    <sec id="cell-fig-validation_set_performance-nb-article" specific-use="notebook-code">
    <code language="r script"># 
# model_final_predictions |&gt; 
#   left_join(cut_dt) |&gt; 
#   ggplot(aes(fct_reorder(
#     ith_in_data_set |&gt; as.character(),
#     crude_protein), crude_protein))+
#   geom_point(aes(fct_reorder(
#     ith_in_data_set |&gt; as.character(),
#     crude_protein), difference), alpha = 0.05, shape = 2) +
#     geom_hline(yintercept = 0, linewidth = 2, lty = 2)+
#   facet_wrap( ~cutpoints, scales = &quot;free_x&quot;,
#           labeller = as_labeller(c(&quot;(20.8,24.1]&quot; = &quot;Low (20.8 - 24.1)&quot;,
#                                    &quot;(24.1,27.5]&quot;= &quot;Medium (24.2 - 27.5)&quot;,
#                                    &quot;(27.5,30.8]&quot; =&quot;High (27.6-30.8)&quot;))) + 
#     theme_classic()+
#   theme(
#     axis.title.x = element_blank(),
#     axis.text.x = element_blank())

model_final_predictions |&gt; 
  left_join(cutpoints2) |&gt; 
  ggplot(aes(fct_reorder(
    ith_in_data_set |&gt; as.character(),
    crude_protein), crude_protein))+
  geom_point(aes(fct_reorder(
    ith_in_data_set |&gt; as.character(),
    crude_protein), difference), alpha = 0.05, shape = 2) +
  geom_hline(yintercept = 0, linewidth = 2, lty = 2) +
  facet_wrap( ~cutpoints, scales = &quot;free_x&quot;,
              labeller = as_labeller(c(&quot;(20.8,24.1]&quot; = &quot;Low CP (20.8 - 24.1%)&quot;,
                                       &quot;(24.1,27.5]&quot;= &quot;Medium CP (24.2 - 27.5%)&quot;,
                                       &quot;(27.5,30.8]&quot; =&quot;High CP (27.6-30.8%)&quot;))) + 
  theme_classic()+
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank())</code>
    <fig id="fig-validation_set_performance-nb-article">
      <caption><p>Figure 3: Test set predictions versus normalized
      scores across hemp samples</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-validation_set_performance-1.png" />
    </fig>
    <sec id="cell-fig-validation_set_performance-output-0-nb-article" specific-use="notebook-output">
    <preformat>Joining with `by = join_by(crude_protein, ith_in_data_set)`</preformat>
    </sec>
    </sec>
    <p>Errors tend to be lower at higher levels of actual CP</p>
    <p>This study is limited in that it represents the creation of one
    model based upon spectra collected from one machine. NIRS
    calibrations can be unique to a particular machine, even if the
    machines compared are of the same model
    (<xref alt="reeves2012?" rid="ref-reeves2012-nb-article" ref-type="bibr"><bold>reeves2012?</bold></xref>).
    As well, the calibration and validation sets are relatively
    small.</p>
    <p>This research showed the promise of the use of NIRS in order to
    make predictions concerning %CP in hemp grain using PLS. Promising
    preprocessing methods were identified and a model was validated.
    Further research could refine the model by including more samples or
    by examining other predictive methods.</p>
  </sec>
</sec>
<sec id="acknowledgments-nb-article">
  <title>ACKNOWLEDGMENTS</title>
</sec>
<sec id="supplemental-material-nb-article">
  <title>SUPPLEMENTAL MATERIAL</title>
</sec>
<sec id="optional-sections-nb-article">
  <title>OPTIONAL SECTIONS</title>
</sec>
<sec id="references-nb-article">
  <title>REFERENCES</title>
</sec>
<sec id="figures-and-tables-nb-article">
  <title>FIGURES AND TABLES</title>
  <sec id="nb-code-cell-17-nb-article" specific-use="notebook-code">
  <code language="r script">eruptions &lt;- c(1492, 1585, 1646, 1677, 1712, 1949, 1971, 2021)
n_eruptions &lt;- length(eruptions)</code>
  </sec>
  <sec id="cell-fig-timeline-nb-article" specific-use="notebook-code">
  <code language="r script">par(mar = c(3, 1, 1, 1) + 0.1)
plot(eruptions, rep(0, n_eruptions), 
  pch = &quot;|&quot;, axes = FALSE)
axis(1)
box()</code>
  <fig id="fig-timeline-nb-article">
    <caption><p>Figure 4: Timeline of recent earthquakes on La
    Palma</p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/fig-timeline-1.png" />
  </fig>
  </sec>
  <sec id="nb-code-cell-18-nb-article" specific-use="notebook-code">
  <code language="r script">avg_years_between_eruptions &lt;- mean(diff(eruptions[-n_eruptions]))
avg_years_between_eruptions</code>
  <sec id="nb-code-cell-18-output-0-nb-article" specific-use="notebook-output">
  <preformat>[1] 79.83333</preformat>
  </sec>
  </sec>
  <p>Based on data up to and including 1971, eruptions on La Palma
  happen every 79.8 years on average.</p>
  <p>Studies of the magma systems feeding the volcano, such as
  (<xref alt="marrero2019?" rid="ref-marrero2019-nb-article" ref-type="bibr"><bold>marrero2019?</bold></xref>),
  have proposed that there are two main magma reservoirs feeding the
  Cumbre Vieja volcano; one in the mantle (30-40km depth) which charges
  and in turn feeds a shallower crustal reservoir (10-20km depth).</p>
  <p>Eight eruptions have been recorded since the late 1400s
  (<xref alt="Figure 4" rid="fig-timeline-nb-article">Figure 4</xref>).</p>
  <p>Data and methods are discussed in
  <xref alt="Section 9" rid="sec-data-methods-nb-article">Section 9</xref>.</p>
  <p>Let <inline-formula><alternatives>
  <tex-math><![CDATA[x]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
  denote the number of eruptions in a year. Then,
  <inline-formula><alternatives>
  <tex-math><![CDATA[x]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
  can be modeled by a Poisson distribution</p>
  <p><styled-content id="eq-poisson-nb-article"><disp-formula><alternatives>
  <tex-math><![CDATA[
  p(x) = \frac{e^{-\lambda} \lambda^{x}}{x !}
   \qquad(1)]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mi>λ</mml:mi><mml:mi>x</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mi>!</mml:mi></mml:mrow></mml:mfrac><mml:mspace width="2.0em"></mml:mspace><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula></styled-content></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[\lambda]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>λ</mml:mi></mml:math></alternatives></inline-formula>
  is the rate of eruptions per year. Using
  <xref alt="Equation 1" rid="eq-poisson-nb-article">Equation 1</xref>, the
  probability of an eruption in the next <inline-formula><alternatives>
  <tex-math><![CDATA[t]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>t</mml:mi></mml:math></alternatives></inline-formula>
  years can be calculated.</p>
  <fig id="tbl-history-nb-article">
    <caption><p>Table 3: Recent historic eruptions on La
    Palma</p></caption>
    <table-wrap>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Year</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Current</td>
            <td>2021</td>
          </tr>
          <tr>
            <td>Teneguía</td>
            <td>1971</td>
          </tr>
          <tr>
            <td>Nambroque</td>
            <td>1949</td>
          </tr>
          <tr>
            <td>El Charco</td>
            <td>1712</td>
          </tr>
          <tr>
            <td>Volcán San Antonio</td>
            <td>1677</td>
          </tr>
          <tr>
            <td>Volcán San Martin</td>
            <td>1646</td>
          </tr>
          <tr>
            <td>Tajuya near El Paso</td>
            <td>1585</td>
          </tr>
          <tr>
            <td>Montaña Quemada</td>
            <td>1492</td>
          </tr>
        </tbody>
      </table>
    </table-wrap>
  </fig>
  <p><xref alt="Table 3" rid="tbl-history-nb-article">Table 3</xref> summarises the
  eruptions recorded since the colonization of the islands by Europeans
  in the late 1400s.</p>
  <fig id="fig-map-nb-article">
    <caption><p>Figure 5: Map of La Palma</p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="images/la-palma-map.png" />
  </fig>
  <p>La Palma is one of the west most islands in the Volcanic
  Archipelago of the Canary Islands
  (<xref alt="Figure 5" rid="fig-map-nb-article">Figure 5</xref>).</p>
  <sec id="cell-fig-spatial-plot-nb-article" specific-use="notebook-code">
  <code language="python">la_palma |&gt; 
  ggplot(aes(Longitude, Latitude)) +
  geom_point(aes(color = Magnitude, size = 40-`Depth(km)`)) +
  scale_color_viridis_c(direction = -1) + 
  scale_size(range = c(0.5, 2), guide = &quot;none&quot;) +
  theme_bw()</code>
  <sec id="cell-fig-spatial-plot-output-0-nb-article" specific-use="notebook-output">
  <fig id="fig-spatial-plot-nb-article">
    <caption><p>Figure 6: Locations of earthquakes on La Palma since
    2017</p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="index_files/figure-jats/notebooks-explore-earthquakes-fig-spatial-plot-output-1.png" />
  </fig>
  </sec>
  </sec>
  <p><xref alt="Figure 6" rid="fig-spatial-plot-nb-article">Figure 6</xref> shows
  the location of recent Earthquakes on La Palma.</p>
</sec>
<sec id="sec-data-methods-nb-article">
  <title>Data &amp; Methods</title>
</sec>
<sec id="conclusion-nb-article">
  <title>Conclusion</title>
</sec>
</body>



<back>
<ref-list>
  <title>References</title>
  <ref id="ref-chadalavada_nir_2022-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Chadalavada</surname><given-names>Keerthi</given-names></name>
        <name><surname>Anbazhagan</surname><given-names>Krithika</given-names></name>
        <name><surname>Ndour</surname><given-names>Adama</given-names></name>
        <name><surname>Choudhary</surname><given-names>Sunita</given-names></name>
        <name><surname>Palmer</surname><given-names>William</given-names></name>
        <name><surname>Flynn</surname><given-names>Jamie R</given-names></name>
        <name><surname>Mallayee</surname><given-names>Srikanth</given-names></name>
        <name><surname>Pothu</surname><given-names>Sharada</given-names></name>
        <name><surname>Prasad</surname><given-names>Kodukula Venkata Subrahamanya Vara</given-names></name>
        <name><surname>Varijakshapanikar</surname><given-names>Padmakumar</given-names></name>
        <name><surname>Jones</surname><given-names>Chris S</given-names></name>
        <name><surname>Kholová</surname><given-names>Jana</given-names></name>
      </person-group>
      <article-title>NIR Instruments and Prediction Methods for Rapid Access to Grain Protein Content in Multiple Cereals.</article-title>
      <source>Sensors (Basel, Switzerland)</source>
      <year iso-8601-date="2022-05">2022</year><month>05</month>
      <volume>22</volume>
      <issue>10</issue>
      <issn>1424-8220</issn>
      <pub-id pub-id-type="doi">10.3390/s22103710</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-reeves_potential_2012-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Reeves</surname><given-names>James B.</given-names></name>
      </person-group>
      <article-title>Potential of Near- and Mid-infrared Spectroscopy in Biofuel Production</article-title>
      <source>Communications in Soil Science and Plant Analysis</source>
      <year iso-8601-date="2012-01">2012</year><month>01</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-03-15">2023</year><month>03</month><day>15</day></date-in-citation>
      <volume>43</volume>
      <issue>1-2</issue>
      <issn>0010-3624</issn>
      <uri>https://doi.org/10.1080/00103624.2012.641844</uri>
      <pub-id pub-id-type="doi">10.1080/00103624.2012.641844</pub-id>
      <fpage>478</fpage>
      <lpage>495</lpage>
    </element-citation>
  </ref>
  <ref id="ref-roberts_near-infrared_2004-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Roberts</surname><given-names>Craig A</given-names></name>
        <name><surname>Workman</surname><given-names>Jerry</given-names></name>
        <name><surname>Reeves</surname><given-names>James B</given-names></name>
      </person-group>
      <source>Near-infrared spectroscopy in agriculture</source>
      <publisher-name>American Society of Agronomy</publisher-name>
      <year iso-8601-date="2004">2004</year>
    </element-citation>
  </ref>
  <ref id="ref-garrido-varo_note_2019-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Garrido-Varo</surname><given-names>A</given-names></name>
        <name><surname>Garcia-Olmo</surname><given-names>J</given-names></name>
        <name><surname>Fearn</surname><given-names>T</given-names></name>
      </person-group>
      <article-title>A note on Mahalanobis and related distance measures in WinISI and The Unscrambler</article-title>
      <source>Journal of Near Infrared Spectroscopy</source>
      <year iso-8601-date="2019-08">2019</year><month>08</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-04-26">2023</year><month>04</month><day>26</day></date-in-citation>
      <volume>27</volume>
      <issue>4</issue>
      <issn>0967-0335</issn>
      <uri>https://doi.org/10.1177/0967033519848296</uri>
      <pub-id pub-id-type="doi">10.1177/0967033519848296</pub-id>
      <fpage>253</fpage>
      <lpage>258</lpage>
    </element-citation>
  </ref>
  <ref id="ref-williams_application_1975-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Williams</surname><given-names>P. C.</given-names></name>
      </person-group>
      <article-title>Application of near infrared reflectance spectroscopy to analysis of cereal grains and oilseeds</article-title>
      <source>Cereal chemistry</source>
      <year iso-8601-date="1975-07">1975</year><month>07</month>
      <volume>52</volume>
      <issue>4 p.561-576</issue>
      <issn>0009-0352</issn>
      <fpage>576</fpage>
      <lpage>561</lpage>
    </element-citation>
  </ref>
  <ref id="ref-barta_proteomic_2024-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Bárta</surname><given-names>Jan</given-names></name>
        <name><surname>Roudnický</surname><given-names>Pavel</given-names></name>
        <name><surname>Jarošová</surname><given-names>Markéta</given-names></name>
        <name><surname>Zdráhal</surname><given-names>Zbyněk</given-names></name>
        <name><surname>Stupková</surname><given-names>Adéla</given-names></name>
        <name><surname>Bártová</surname><given-names>Veronika</given-names></name>
        <name><surname>Krejčová</surname><given-names>Zlatuše</given-names></name>
        <name><surname>Kyselka</surname><given-names>Jan</given-names></name>
        <name><surname>Filip</surname><given-names>Vladimír</given-names></name>
        <name><surname>Říha</surname><given-names>Václav</given-names></name>
        <name><surname>Lorenc</surname><given-names>František</given-names></name>
        <name><surname>Bedrníček</surname><given-names>Jan</given-names></name>
        <name><surname>Smetana</surname><given-names>Pavel</given-names></name>
      </person-group>
      <article-title>Proteomic Profiles of Whole Seeds, Hulls, and Dehulled Seeds of Two Industrial Hemp (Cannabis sativa L.) Cultivars</article-title>
      <source>Plants</source>
      <year iso-8601-date="2024-01">2024</year><month>01</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-07">2024</year><month>03</month><day>07</day></date-in-citation>
      <volume>13</volume>
      <issue>1</issue>
      <issn>2223-7747</issn>
      <uri>https://www.mdpi.com/2223-7747/13/1/111</uri>
      <pub-id pub-id-type="doi">10.3390/plants13010111</pub-id>
      <fpage>111</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-geyer_genetics_2022-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Geyer</surname><given-names>Manuel</given-names></name>
        <name><surname>Mohler</surname><given-names>Volker</given-names></name>
        <name><surname>Hartl</surname><given-names>Lorenz</given-names></name>
      </person-group>
      <article-title>Genetics of the Inverse Relationship between Grain Yield and Grain Protein Content in Common Wheat</article-title>
      <source>Plants</source>
      <year iso-8601-date="2022-08">2022</year><month>08</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-07">2024</year><month>03</month><day>07</day></date-in-citation>
      <volume>11</volume>
      <issue>16</issue>
      <issn>2223-7747</issn>
      <uri>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9413592/</uri>
      <pub-id pub-id-type="doi">10.3390/plants11162146</pub-id>
      <pub-id pub-id-type="pmid">36015449</pub-id>
      <fpage>2146</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-giancaspro_genetic_2019-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Giancaspro</surname><given-names>Angelica</given-names></name>
        <name><surname>Giove</surname><given-names>Stefania L.</given-names></name>
        <name><surname>Blanco</surname><given-names>Antonio</given-names></name>
        <name><surname>Gadaleta</surname><given-names>Agata</given-names></name>
      </person-group>
      <article-title>Genetic Variation for Protein Content and Yield-Related Traits in a Durum Population Derived From an Inter-Specific Cross Between Hexaploid and Tetraploid Wheat Cultivars</article-title>
      <source>Frontiers in Plant Science</source>
      <year iso-8601-date="2019-11">2019</year><month>11</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-07">2024</year><month>03</month><day>07</day></date-in-citation>
      <volume>10</volume>
      <issn>1664-462X</issn>
      <uri>https://www.frontiersin.org/journals/plant-science/articles/10.3389/fpls.2019.01509/full</uri>
      <pub-id pub-id-type="doi">10.3389/fpls.2019.01509</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-ely_industrial_2022-nb-article">
    <element-citation publication-type="chapter">
      <person-group person-group-type="author">
        <name><surname>Ely</surname><given-names>Kristine</given-names></name>
        <name><surname>Fike</surname><given-names>John</given-names></name>
      </person-group>
      <article-title>Industrial Hemp and Hemp Byproducts as Sustainable Feedstuffs in Livestock Diets</article-title>
      <source>Cannabis/Hemp for Sustainable Agriculture and Materials</source>
      <person-group person-group-type="editor">
        <name><surname>Agrawal</surname><given-names>Dinesh Chandra</given-names></name>
        <name><surname>Kumar</surname><given-names>Rajiv</given-names></name>
        <name><surname>Dhanasekaran</surname><given-names>Muralikrishnan</given-names></name>
      </person-group>
      <publisher-name>Springer</publisher-name>
      <publisher-loc>Singapore</publisher-loc>
      <year iso-8601-date="2022">2022</year>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-08">2024</year><month>03</month><day>08</day></date-in-citation>
      <isbn>9789811687785</isbn>
      <uri>https://doi.org/10.1007/978-981-16-8778-5_6</uri>
      <pub-id pub-id-type="doi">10.1007/978-981-16-8778-5_6</pub-id>
      <fpage>145</fpage>
      <lpage>162</lpage>
    </element-citation>
  </ref>
  <ref id="ref-hayes_measuring_2020-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hayes</surname><given-names>Maria</given-names></name>
      </person-group>
      <article-title>Measuring Protein Content in Food: An Overview of Methods</article-title>
      <source>Foods</source>
      <year iso-8601-date="2020-09">2020</year><month>09</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-03-08">2024</year><month>03</month><day>08</day></date-in-citation>
      <volume>9</volume>
      <issue>10</issue>
      <issn>2304-8158</issn>
      <uri>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7597951/</uri>
      <pub-id pub-id-type="doi">10.3390/foods9101340</pub-id>
      <pub-id pub-id-type="pmid">32977393</pub-id>
      <fpage>1340</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-bellon-maurel2010-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Bellon-Maurel</surname><given-names>Véronique</given-names></name>
        <name><surname>Fernandez-Ahumada</surname><given-names>Elvira</given-names></name>
        <name><surname>Palagos</surname><given-names>Bernard</given-names></name>
        <name><surname>Roger</surname><given-names>Jean-Michel</given-names></name>
        <name><surname>McBratney</surname><given-names>Alex</given-names></name>
      </person-group>
      <article-title>Critical review of chemometric indicators commonly used for assessing the quality of the prediction of soil attributes by NIR spectroscopy</article-title>
      <source>TrAC Trends in Analytical Chemistry</source>
      <year iso-8601-date="2010-10-01">2010</year><month>10</month><day>01</day>
      <volume>29</volume>
      <issue>9</issue>
      <uri>https://www.sciencedirect.com/science/article/pii/S0165993610001585</uri>
      <pub-id pub-id-type="doi">10.1016/j.trac.2010.05.006</pub-id>
      <fpage>1073</fpage>
      <lpage>1081</lpage>
    </element-citation>
  </ref>
  <ref id="ref-base-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <string-name>R Core Team</string-name>
      </person-group>
      <source>R: A language and environment for statistical computing</source>
      <publisher-name>R Foundation for Statistical Computing</publisher-name>
      <publisher-loc>Vienna, Austria</publisher-loc>
      <year iso-8601-date="2024">2024</year>
      <uri>https://www.R-project.org/</uri>
    </element-citation>
  </ref>
  <ref id="ref-caret-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <string-name>Kuhn</string-name>
        <string-name>Max</string-name>
      </person-group>
      <article-title>Building predictive models in r using the caret package</article-title>
      <source>Journal of Statistical Software</source>
      <year iso-8601-date="2008">2008</year>
      <volume>28</volume>
      <issue>5</issue>
      <uri>https://www.jstatsoft.org/index.php/jss/article/view/v028i05</uri>
      <pub-id pub-id-type="doi">10.18637/jss.v028.i05</pub-id>
      <fpage>1</fpage>
      <lpage>26</lpage>
    </element-citation>
  </ref>
  <ref id="ref-datatable-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Barrett</surname><given-names>Tyson</given-names></name>
        <name><surname>Dowle</surname><given-names>Matt</given-names></name>
        <name><surname>Srinivasan</surname><given-names>Arun</given-names></name>
        <name><surname>Gorecki</surname><given-names>Jan</given-names></name>
        <name><surname>Chirico</surname><given-names>Michael</given-names></name>
        <name><surname>Hocking</surname><given-names>Toby</given-names></name>
      </person-group>
      <source>data.table: Extension of ‘data.frame’</source>
      <year iso-8601-date="2024">2024</year>
      <uri>https://CRAN.R-project.org/package=data.table</uri>
    </element-citation>
  </ref>
  <ref id="ref-emmeans-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Lenth</surname><given-names>Russell V.</given-names></name>
      </person-group>
      <source>emmeans: Estimated marginal means, aka least-squares means</source>
      <year iso-8601-date="2024">2024</year>
      <uri>https://CRAN.R-project.org/package=emmeans</uri>
    </element-citation>
  </ref>
  <ref id="ref-knitr2023-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
      </person-group>
      <source>knitr: A general-purpose package for dynamic report generation in r</source>
      <year iso-8601-date="2023">2023</year>
      <uri>https://yihui.org/knitr/</uri>
    </element-citation>
  </ref>
  <ref id="ref-knitr2015-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
      </person-group>
      <source>Dynamic documents with R and knitr</source>
      <publisher-name>Chapman; Hall/CRC</publisher-name>
      <publisher-loc>Boca Raton, Florida</publisher-loc>
      <year iso-8601-date="2015">2015</year>
      <edition>2nd</edition>
      <uri>https://yihui.org/knitr/</uri>
    </element-citation>
  </ref>
  <ref id="ref-knitr2014-nb-article">
    <element-citation publication-type="chapter">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
      </person-group>
      <article-title>knitr: A comprehensive tool for reproducible research in R</article-title>
      <source>Implementing reproducible computational research</source>
      <person-group person-group-type="editor">
        <name><surname>Stodden</surname><given-names>Victoria</given-names></name>
        <name><surname>Leisch</surname><given-names>Friedrich</given-names></name>
        <name><surname>Peng</surname><given-names>Roger D.</given-names></name>
      </person-group>
      <publisher-name>Chapman; Hall/CRC</publisher-name>
      <year iso-8601-date="2014">2014</year>
    </element-citation>
  </ref>
  <ref id="ref-lme4-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Bates</surname><given-names>Douglas</given-names></name>
        <name><surname>Mächler</surname><given-names>Martin</given-names></name>
        <name><surname>Bolker</surname><given-names>Ben</given-names></name>
        <name><surname>Walker</surname><given-names>Steve</given-names></name>
      </person-group>
      <article-title>Fitting linear mixed-effects models using lme4</article-title>
      <source>Journal of Statistical Software</source>
      <year iso-8601-date="2015">2015</year>
      <volume>67</volume>
      <issue>1</issue>
      <pub-id pub-id-type="doi">10.18637/jss.v067.i01</pub-id>
      <fpage>1</fpage>
      <lpage>48</lpage>
    </element-citation>
  </ref>
  <ref id="ref-multcomp-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hothorn</surname><given-names>Torsten</given-names></name>
        <name><surname>Bretz</surname><given-names>Frank</given-names></name>
        <name><surname>Westfall</surname><given-names>Peter</given-names></name>
      </person-group>
      <article-title>Simultaneous inference in general parametric models</article-title>
      <source>Biometrical Journal</source>
      <year iso-8601-date="2008">2008</year>
      <volume>50</volume>
      <issue>3</issue>
      <fpage>346</fpage>
      <lpage>363</lpage>
    </element-citation>
  </ref>
  <ref id="ref-nlme2023-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Pinheiro</surname><given-names>José</given-names></name>
        <name><surname>Bates</surname><given-names>Douglas</given-names></name>
        <string-name>R Core Team</string-name>
      </person-group>
      <source>nlme: Linear and nonlinear mixed effects models</source>
      <year iso-8601-date="2023">2023</year>
      <uri>https://CRAN.R-project.org/package=nlme</uri>
    </element-citation>
  </ref>
  <ref id="ref-nlme2000-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Pinheiro</surname><given-names>José C.</given-names></name>
        <name><surname>Bates</surname><given-names>Douglas M.</given-names></name>
      </person-group>
      <source>Mixed-effects models in s and s-PLUS</source>
      <publisher-name>Springer</publisher-name>
      <publisher-loc>New York</publisher-loc>
      <year iso-8601-date="2000">2000</year>
      <pub-id pub-id-type="doi">10.1007/b98882</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-pls-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Liland</surname><given-names>Kristian Hovde</given-names></name>
        <name><surname>Mevik</surname><given-names>Bjørn-Helge</given-names></name>
        <name><surname>Wehrens</surname><given-names>Ron</given-names></name>
      </person-group>
      <source>pls: Partial least squares and principal component regression</source>
      <year iso-8601-date="2023">2023</year>
      <uri>https://CRAN.R-project.org/package=pls</uri>
    </element-citation>
  </ref>
  <ref id="ref-prospectr-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Stevens</surname><given-names>Antoine</given-names></name>
        <name><surname>Ramirez-Lopez</surname><given-names>Leornardo</given-names></name>
      </person-group>
      <source>An introduction to the prospectr package</source>
      <year iso-8601-date="2024">2024</year>
    </element-citation>
  </ref>
  <ref id="ref-randomForest-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Liaw</surname><given-names>Andy</given-names></name>
        <name><surname>Wiener</surname><given-names>Matthew</given-names></name>
      </person-group>
      <article-title>Classification and regression by randomForest</article-title>
      <source>R News</source>
      <year iso-8601-date="2002">2002</year>
      <volume>2</volume>
      <issue>3</issue>
      <uri>https://CRAN.R-project.org/doc/Rnews/</uri>
      <fpage>18</fpage>
      <lpage>22</lpage>
    </element-citation>
  </ref>
  <ref id="ref-rmarkdown2024-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Allaire</surname><given-names>JJ</given-names></name>
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
        <name><surname>Dervieux</surname><given-names>Christophe</given-names></name>
        <name><surname>McPherson</surname><given-names>Jonathan</given-names></name>
        <name><surname>Luraschi</surname><given-names>Javier</given-names></name>
        <name><surname>Ushey</surname><given-names>Kevin</given-names></name>
        <name><surname>Atkins</surname><given-names>Aron</given-names></name>
        <name><surname>Wickham</surname><given-names>Hadley</given-names></name>
        <name><surname>Cheng</surname><given-names>Joe</given-names></name>
        <name><surname>Chang</surname><given-names>Winston</given-names></name>
        <name><surname>Iannone</surname><given-names>Richard</given-names></name>
      </person-group>
      <source>rmarkdown: Dynamic documents for r</source>
      <year iso-8601-date="2024">2024</year>
      <uri>https://github.com/rstudio/rmarkdown</uri>
    </element-citation>
  </ref>
  <ref id="ref-rmarkdown2018-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
        <name><surname>Allaire</surname><given-names>J. J.</given-names></name>
        <name><surname>Grolemund</surname><given-names>Garrett</given-names></name>
      </person-group>
      <source>R markdown: The definitive guide</source>
      <publisher-name>Chapman; Hall/CRC</publisher-name>
      <publisher-loc>Boca Raton, Florida</publisher-loc>
      <year iso-8601-date="2018">2018</year>
      <isbn>9781138359338</isbn>
      <uri>https://bookdown.org/yihui/rmarkdown</uri>
    </element-citation>
  </ref>
  <ref id="ref-rmarkdown2020-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Xie</surname><given-names>Yihui</given-names></name>
        <name><surname>Dervieux</surname><given-names>Christophe</given-names></name>
        <name><surname>Riederer</surname><given-names>Emily</given-names></name>
      </person-group>
      <source>R markdown cookbook</source>
      <publisher-name>Chapman; Hall/CRC</publisher-name>
      <publisher-loc>Boca Raton, Florida</publisher-loc>
      <year iso-8601-date="2020">2020</year>
      <isbn>9780367563837</isbn>
      <uri>https://bookdown.org/yihui/rmarkdown-cookbook</uri>
    </element-citation>
  </ref>
  <ref id="ref-skimr-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Waring</surname><given-names>Elin</given-names></name>
        <name><surname>Quinn</surname><given-names>Michael</given-names></name>
        <name><surname>McNamara</surname><given-names>Amelia</given-names></name>
        <name><surname>Arino de la Rubia</surname><given-names>Eduardo</given-names></name>
        <name><surname>Zhu</surname><given-names>Hao</given-names></name>
        <name><surname>Ellis</surname><given-names>Shannon</given-names></name>
      </person-group>
      <source>skimr: Compact and flexible summaries of data</source>
      <year iso-8601-date="2022">2022</year>
      <uri>https://CRAN.R-project.org/package=skimr</uri>
    </element-citation>
  </ref>
  <ref id="ref-tidymodels-nb-article">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Kuhn</surname><given-names>Max</given-names></name>
        <name><surname>Wickham</surname><given-names>Hadley</given-names></name>
      </person-group>
      <source>Tidymodels: A collection of packages for modeling and machine learning using tidyverse principles.</source>
      <year iso-8601-date="2020">2020</year>
      <uri>https://www.tidymodels.org</uri>
    </element-citation>
  </ref>
  <ref id="ref-tidyverse-nb-article">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Wickham</surname><given-names>Hadley</given-names></name>
        <name><surname>Averick</surname><given-names>Mara</given-names></name>
        <name><surname>Bryan</surname><given-names>Jennifer</given-names></name>
        <name><surname>Chang</surname><given-names>Winston</given-names></name>
        <name><surname>McGowan</surname><given-names>Lucy D’Agostino</given-names></name>
        <name><surname>François</surname><given-names>Romain</given-names></name>
        <name><surname>Grolemund</surname><given-names>Garrett</given-names></name>
        <name><surname>Hayes</surname><given-names>Alex</given-names></name>
        <name><surname>Henry</surname><given-names>Lionel</given-names></name>
        <name><surname>Hester</surname><given-names>Jim</given-names></name>
        <name><surname>Kuhn</surname><given-names>Max</given-names></name>
        <name><surname>Pedersen</surname><given-names>Thomas Lin</given-names></name>
        <name><surname>Miller</surname><given-names>Evan</given-names></name>
        <name><surname>Bache</surname><given-names>Stephan Milton</given-names></name>
        <name><surname>Müller</surname><given-names>Kirill</given-names></name>
        <name><surname>Ooms</surname><given-names>Jeroen</given-names></name>
        <name><surname>Robinson</surname><given-names>David</given-names></name>
        <name><surname>Seidel</surname><given-names>Dana Paige</given-names></name>
        <name><surname>Spinu</surname><given-names>Vitalie</given-names></name>
        <name><surname>Takahashi</surname><given-names>Kohske</given-names></name>
        <name><surname>Vaughan</surname><given-names>Davis</given-names></name>
        <name><surname>Wilke</surname><given-names>Claus</given-names></name>
        <name><surname>Woo</surname><given-names>Kara</given-names></name>
        <name><surname>Yutani</surname><given-names>Hiroaki</given-names></name>
      </person-group>
      <article-title>Welcome to the tidyverse</article-title>
      <source>Journal of Open Source Software</source>
      <year iso-8601-date="2019">2019</year>
      <volume>4</volume>
      <issue>43</issue>
      <pub-id pub-id-type="doi">10.21105/joss.01686</pub-id>
      <fpage>1686</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
</ref-list>
</back>


</sub-article>
<sub-article article-type="notebook" id="nb-4-nb-1">
<front-stub>
<title-group>
<article-title>Explore Earthquakes</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Wickham</surname>
<given-names>Charlotte</given-names>
</name>
<string-name>Charlotte Wickham</string-name>

</contrib>
</contrib-group>
</front-stub>

<body>
<sec id="nb-code-cell-1-nb-1" specific-use="notebook-code">
<code language="r script">library(tidyverse)
</code>
<sec id="nb-code-cell-1-output-0-nb-1" specific-use="notebook-output">
<preformat>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</preformat>
</sec>
</sec>
<p>Read a clean version of data:</p>
<sec id="nb-code-cell-2-nb-1" specific-use="notebook-code">
<code language="r script">la_palma &lt;- read_csv(&quot;la-palma.csv&quot;)
</code>
<sec id="nb-code-cell-2-output-0-nb-1" specific-use="notebook-output">
<preformat>Rows: 11347 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
dbl  (4): Longitude, Latitude, Depth(km), Magnitude
dttm (1): DateTime

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</preformat>
</sec>
</sec>
<p>Create spatial plot:</p>
<sec id="cell-fig-spatial-plot-nb-1" specific-use="notebook-code">
<code language="r script">#|   against longitude.&quot;
la_palma |&gt; 
  ggplot(aes(Longitude, Latitude)) +
  geom_point(aes(color = Magnitude, size = 40-`Depth(km)`)) +
  scale_color_viridis_c(direction = -1) + 
  scale_size(range = c(0.5, 2), guide = &quot;none&quot;) +
  theme_bw()
</code>
<fig id="fig-spatial-plot-nb-1">
  <caption><p>Locations of earthquakes on La Palma since
  2017</p></caption>
  <graphic mimetype="image" mime-subtype="png" xlink:href="explore-earthquakes_files/figure-jats/fig-spatial-plot-1.png" />
</fig>
</sec>
</body>



<back>
</back>


</sub-article>

</article>